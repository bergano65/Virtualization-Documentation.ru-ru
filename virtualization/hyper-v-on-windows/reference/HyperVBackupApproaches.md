# <a name="hyper-v-backup-approaches"></a>Подходы к резервному копированию Hyper-V
Hyper-V позволяет выполнять резервное копирование виртуальных машин из операционной системы узла без необходимости запуска настраиваемого программного обеспечения резервного копирования в виртуальной машине.  Существует несколько подходов, которые разработчики могут использовать в зависимости от своих нужд.
## <a name="hyper-v-vss-writer"></a>Модуль записи VSS Hyper-V
Hyper-V реализует модуль записи VSS во всех версиях Windows Server, где поддерживается Hyper-V.  Этот модуль записи VSS позволяет разработчикам использовать существующую инфраструктуру VSS для резервного копирования виртуальных машин.  Однако она предназначена для небольших операций резервного копирования, где все виртуальные машины на сервере архивируются одновременно.

Чтобы лучше понять эту архитектуру, см. следующую презентацию: https://channel9.msdn.com/Events/TechEd/NorthAmerica/2010/VIR322
## <a name="hyper-v-wmi-based-backup"></a>Резервное копирование на основе WMI Hyper-V
Начиная с Windows Server 2016, Hyper-V начал поддерживать резервное копирование с помощью API WMI Hyper-V.  Этот подход по-прежнему использует VSS внутри виртуальной машины для резервного копирования, но больше не будет использовать VSS в операционной системе узла.  Вместо этого используется сочетание опорных точек и отказоустойчивого отслеживания изменений (RCT), позволяющее разработчикам эффективно получать доступ к сведениям о резервном копировании виртуальных машин.  Этот подход является более масштабируемым, чем использование VSS на узле, однако он доступен только в Windows Server 2016 и более поздних версиях.

Чтобы лучше понять эту архитектуру, см. следующую презентацию: https://channel9.msdn.com/Events/TechEd/Europe/2014/CDP-B318 

Есть также пример использования этих API-интерфейсов: https://www.powershellgallery.com/packages/xHyper-VBackup
## <a name="methods-for-reading-backups-from-wmi-based-backup"></a>Методы чтения резервных копий из резервной копии на основе WMI
При создании резервных копий виртуальных машин с помощью Hyper-V WMI существует три метода чтения фактических данных из резервной копии.  Каждый из них обладает уникальными преимуществами и недостатками.
### <a name="wmi-export"></a>Экспорт WMI
Разработчики могут экспортировать данные резервных копий с помощью интерфейсов WMI Hyper-V (как показано в примере выше).  Hyper-V выполнит компиляцию изменений на виртуальный жесткий диск и скопирует файл в запрошенное расположение.  Этот метод прост в использовании, работает для всех сценариев и является удаленным.  Однако создаваемый виртуальный жесткий диск часто создает большой объем данных для передачи по сети.
### <a name="win32-apis"></a>API-интерфейсы Win32;
Разработчики могут использовать API Сетвиртуалдискинформатион, Жетвиртуалдискинформатион и Куеричанжесвиртуалдиск на наборе API Win32 для виртуального жесткого диска, как описано здесь: https://docs.microsoft.com/windows/desktop/api/_vhd/ Обратите внимание, что для использования этих интерфейсов API Hyper-V WMI по-прежнему необходимо использовать для создания опорных точек на связанных виртуальных машинах.  Затем эти API-интерфейсы Win32 обеспечивают эффективный доступ к данным резервной копии виртуальной машины.  У API-интерфейсов Win32 есть несколько ограничений.
* Доступ к ним возможен только в локальной среде
* Не поддерживают чтение данных из общих файлов виртуального жесткого диска
* Они возвращают адреса данных, связанные с внутренней структурой виртуального жесткого диска.

### <a name="remote-shared-virtual-disk-protocol"></a>Протокол удаленного общего виртуального диска
Наконец, если разработчику требуется эффективный доступ к сведениям о резервных копиях из общего файла виртуального жесткого диска, необходимо использовать протокол удаленного общего виртуального диска.  Этот Протокол описан [здесь](https://docs.microsoft.com/openspecs/windows_protocols/ms-rsvd/c865c326-47d6-4a91-a62d-0e8f26007d15).
