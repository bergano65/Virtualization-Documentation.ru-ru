# <a name="hyper-v-backup-approaches"></a>Подходы к резервному копированию Hyper-V
Hyper-V позволяет создавать резервные копии виртуальных машин из операционной системы узла без необходимости запускать настраиваемое программное обеспечение для резервного копирования в виртуальной машине.  Существует несколько подходов, которые можно использовать разработчикам в зависимости от их потребностей.
## <a name="hyper-v-vss-writer"></a>Модуль записи VSS Hyper-V
Hyper-V реализует средство записи VSS во всех версиях Windows Server, где поддерживается Hyper-V.  Этот модуль записи VSS позволяет разработчикам использовать существующую инфраструктуру VSS для резервного копирования виртуальных машин.  Однако оно предназначено для операций с малым масштабированием резервного копирования, где все виртуальные машины на сервере записываются одновременно.

Чтобы понять, как эта архитектура лучше обоснованной, ознакомьтесь с этой презентацией.https://channel9.msdn.com/Events/TechEd/NorthAmerica/2010/VIR322
## <a name="hyper-v-wmi-based-backup"></a>Резервная копия на базе WMI Hyper-V
Начиная с Windows Server 2016, Hyper-V начата поддержка резервного копирования с помощью WMI API Hyper-V.  Этот подход по-прежнему использует VSS внутри виртуальной машины для резервного копирования, но больше не будет использовать VSS в операционной системе узла.  Вместо этого используется сочетание опорных точек и отказоустойчивого отслеживания изменений (RCT), позволяющее разработчикам получить доступ к сведениям о резервном восстановлении виртуальных машин с помощью эффективного способа.  Этот подход более масштабируемый, чем использование VSS на узле, однако он доступен только в Windows Server 2016 и более поздних версиях.

Чтобы понять, как эта архитектура лучше обоснованной, ознакомьтесь с этой презентацией.https://channel9.msdn.com/Events/TechEd/Europe/2014/CDP-B318 

Здесь также приводится пример использования этих API:https://www.powershellgallery.com/packages/xHyper-VBackup
## <a name="methods-for-reading-backups-from-wmi-based-backup"></a>Способы чтения резервных копий из резервной копии на основе WMI
Для создания резервных копий виртуальных машин с помощью Hyper-V WMI существуют три способа чтения фактических данных из резервной копии.  Каждый из них имеет уникальные достоинства и недостатки.
### <a name="wmi-export"></a>Экспорт WMI
Разработчики могут экспортировать резервные данные через интерфейсы WMI Hyper-V (как показано в приведенном выше примере).  Hyper-V выполнит компиляцию изменений на виртуальный жесткий диск и скопирует файл в нужное место.  Этот метод прост в использовании, работает во всех сценариях и является удаленным.  Тем не менее, создаваемый виртуальный жесткий диск часто создает большой объем данных для передачи по сети.
### <a name="win32-apis"></a>Интерфейсы API Win32
Разработчики могут использовать API Сетвиртуалдискинформатион, Жетвиртуалдискинформатион и Куеричанжесвиртуалдиск на виртуальном жестком диске API Win32, как описано здесь: Обратите внимание на то, что чтобы использовать эти API, для создания ссылки необходимо использовать WMI Hyper-V. https://docs.microsoft.com/windows/desktop/api/_vhd/ точки на связанных виртуальных машинах.  Эти API Win32 обеспечивают эффективный доступ к данным резервной копии виртуальной машины.  У API-интерфейсов Win32 есть несколько ограничений:
* Доступ к ним можно получить только на локальном компьютере
* Параметр "не поддерживает чтение данных из общих файлов виртуального жесткого диска"
* Они возвращают адреса данных, которые относятся к внутренней структуре виртуального жесткого диска.

### <a name="remote-shared-virtual-disk-protocol"></a>Протокол удаленного доступного виртуального диска
Наконец, если разработчику необходимо эффективно получить доступ к сведениям о резервных данных из общего файла виртуального жесткого диска, необходимо использовать протокол удаленного общего виртуального диска.  Этот Протокол описан [здесь](https://docs.microsoft.com/openspecs/windows_protocols/ms-rsvd/c865c326-47d6-4a91-a62d-0e8f26007d15).
