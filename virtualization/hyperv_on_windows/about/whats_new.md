# Новые возможности Hyper-V в Windows 10

В этом разделе приводятся сведения о новых и измененных функциях Hyper-V в Windows 10®.

## Windows PowerShell Direct

Теперь у вас есть простой и надежный способ выполнения команд Windows PowerShell в виртуальной машине из операционной системы узла. При этом не нужно выполнять никаких требований к сети или брандмауэру или создавать специальную конфигурацию. 
Это решение работает независимо от конфигурации удаленного управления. Чтобы использовать его, необходимо запустить Windows 10 или Windows Server Technical Preview на узле и в гостевой операционной системе виртуальной машины.

Чтобы создать сеанс PowerShell Direct, используйте одну из следующих команд:

``` PowerShell
Enter-PSSession -VMName VMName
Invoke-Command -VMName VMName -ScriptBlock { commands }
```

Сейчас администраторы Hyper-V используют две категории средств для подключения к виртуальной машине на своем узле Hyper-V:
- средства удаленного управления, например PowerShell или удаленный рабочий стол;
- подключение к виртуальной машине Hyper-V (VMConnect).

Обе эти технологии имеют свои преимущества и недостатки, которые проявляются по мере роста развертывания Hyper-V. VMConnect — надежное средство, но его может быть трудно автоматизировать. PowerShell для удаленного использования обладает широкими возможностями, но с его установкой и обслуживанием могут возникнуть трудности.

Windows PowerShell Direct предоставляет широкие возможности создания сценариев и автоматизации в сочетании с простотой VMConnect. Поскольку Windows PowerShell Direct работает между узлом и виртуальной машиной, нет необходимости устанавливать подключение к сети или включать удаленное управление. Для входа в виртуальную машину вам потребуются гостевые учетные данные.

### Требования

- Необходимо подключение к Windows 10 или узлу Windows Server Technical Preview с виртуальными машинами, на которых Windows 10 или Windows Server Technical Preview работают как гостевые системы.
- Необходимо войти в систему с учетными данными администратора Hyper-V на узле.
- Необходимы учетные данные пользователя для виртуальной машины.
- Виртуальная машина, к которой вы хотите подключиться, должна быть запущена и загружена.


## Горячее добавление и удаление сетевых адаптеров и памяти

Теперь можно без простоев добавлять и удалять сетевые адаптеры во время работы виртуальной машины. Это применимо к виртуальным машинам поколения 2 под управлением ОС Windows и Linux.

Можно также настроить объем памяти, выделенный виртуальной машине, без прерывания ее работы, даже если не включена динамическая память. Это применимо к виртуальным машинам поколений 1 и 2.

## Рабочие контрольные точки

Рабочие контрольные точки позволяют легко создавать образы виртуальных машин на определенный момент времени. Затем эти виртуальные машины можно восстановить способом, который полностью поддерживается для всех рабочих нагрузок. Это возможно благодаря использованию технологии резервного копирования в гостевой системе для создания контрольной точки вместо технологии сохраненного состояния. Для рабочих контрольных точек в виртуальных машинах Windows используется служба моментальных снимков томов (VSS). Виртуальные машины Linux очищают буферы своих файловых систем, чтобы создать контрольную точку, учитывающую состояние файловых систем. Чтобы создать контрольные точки с помощью технологии сохраненного состояния, по-прежнему можно использовать стандартные контрольные точки для виртуальной машины.


> **Внимание!** По умолчанию новые виртуальные машины создают рабочие контрольные точки с резервным подключением стандартных контрольных точек.


## Улучшения диспетчера Hyper-V

- **Поддержка альтернативных учетных данных** — теперь при подключении к удаленному узлу другого экземпляра Windows 10 Technical Preview в диспетчере Hyper-V можно использовать другой набор учетных данных. Кроме того, можно сохранить эти учетные данные, чтобы было проще войти в систему позже.

- **Управление нижним уровнем** — теперь можно использовать диспетчер Hyper-V для управления еще большим количеством версий Hyper-V. Диспетчер Hyper-V в Windows 10 Technical Preview позволяет управлять компьютерами, на которых работает Hyper-V в Windows Server 2012, Windows 8, Windows Server 2012 R2 и Windows 8.1.

- **Обновленный протокол управления** — в диспетчер Hyper-V добавлена возможность взаимодействия с удаленными узлами Hyper-V с помощью протокола WS-MAN, позволяющего использовать проверку подлинности CredSSP, Kerberos или NTLM. При использовании CredSSP для подключения к удаленному узлу Hyper-V можно выполнять динамическую миграцию без предварительного включения ограниченного делегирования в Active Directory. Инфраструктура на основе WS-MAN также упрощает настройку, необходимую, чтобы включить узел для удаленного управления. WS-MAN подключается через порт 80, который открыт по умолчанию.


## Теперь режим ожидания с подключением доступен

Состояние электропитания "Ожидание с подключением" теперь доступно, когда система Hyper-V включена на компьютере, использующем модель электропитания "Всегда включен, всегда на связи" (AOAC).

В Windows 8 и 8.1 из-за Hyper-V компьютеры, использующие модель питания AOAC (также известную как InstantON), никогда не переходили в спящий режим. Подробные сведения см. в этой [статье базы знаний](
https://support.microsoft.com/ru-ru/kb/2973536).


## Безопасная загрузка Linux

Теперь безопасная загрузка доступна для большего числа операционных систем Linux, работающих на виртуальных машинах поколения 2. Безопасная загрузка на узлах, на которых работает Technical Preview, включена для Ubuntu 14.04 и более поздних версий и SUSE Linux Enterprise Server 12. Прежде чем загрузить виртуальную машину в первый раз, необходимо указать, что этой виртуально машине следует использовать центр сертификации Microsoft UEFI. В командной строке Windows PowerShell с повышенными привилегиями введите:

    Set-VMFirmware vmname -SecureBootTemplate MicrosoftUEFICertificateAuthority

Подробнее о запуске виртуальных машин Linux в Hyper-V см. в статье [Виртуальные машины Linux и FreeBSD в Hyper-V](http://technet.microsoft.com/library/dn531030.aspx).


## Версия конфигурации виртуальной машины

При перемещении или импорте виртуальной машины на узел, на котором работает Hyper-V в Windows 10, с узла под управлением Windows 8.1 файл конфигурации виртуальной машины не обновляется автоматически. Это позволяет переместить виртуальную машину обратно на узел под управлением Windows 8.1. Новые функции виртуальной машины будут недоступны, пока вы вручную не обновите версию конфигурации виртуальной машины.

Версия конфигурации виртуальной машины указывает, с какой версией Hyper-V совместимы конфигурация, сохраненное состояние и файлы моментальных снимков виртуальной машины. Виртуальные машины с конфигурацией версии 5 совместимы с Windows 8.1 и могут работать в Windows 8.1 и Windows 10. Виртуальные машины с версией конфигурации 6 совместимы с Windows 10 и не запускаются в Windows 8.1.

### Проверка версии конфигурации

В командной строке с повышенными привилегиями введите следующую команду:

``` PowerShell
Get-VM * | Format-Table Name, Version
```

### Обновление версии конфигурации

В командной строке Windows PowerShell с повышенными привилегиями выполните одну из следующих команд:

``` PowerShell
Update-VmConfigurationVersion <vmname>
```

Или

``` PowerShell
Update-VmConfigurationVersion <vmobject>
```

**Внимание! **
- После обновления версии конфигурации виртуальной машины невозможно переместить виртуальную машину на узел под управлением Windows 8.1.
- Понизить версию конфигурации виртуальной машины с 6 до 5 невозможно.
- Чтобы обновить конфигурацию виртуальной машины, необходимо отключить эту виртуальную машину.
- После обновления виртуальная машина использует новый формат файла конфигурации. Подробнее в разделе "Новый формат файлов конфигурации виртуальной машины".


## Формат файлов конфигурации

Виртуальные машины теперь имеют новый формат файлов конфигурации, повышающий эффективность чтения и записи данных конфигурации виртуальных машин. Этот формат также снижает риск повреждения данных в случае сбоя хранилища. Новые файлы конфигурации используют расширение VMCX для данных конфигурации виртуальных машин и расширение VMRS для данных о состоянии среды выполнения.


> **Внимание!** Файл VMCX имеет двоичный формат. Непосредственное редактирование файлов VMCX и VMRS не поддерживается.

## Обновление служб интеграции через Центр обновления Windows

Обновления для служб интеграции для гостевых систем Windows теперь распространяются через Центр обновления Windows.

Компоненты интеграции (также называемые службами интеграции) — это ряд синтетических драйверов, позволяющих виртуальной машине связываться с операционной системой узла. Они управляют различными службами: от синхронизации времени до копирования гостевых файлов. В течение последнего года мы обсуждали с клиентами установку и обновление компонентов интеграции и узнали, что эти операции серьезно усложняют процесс обновления.


Раньше все новые версии Hyper-V выпускались с новыми компонентами интеграции. Для обновления узла Hyper-V требовалось также обновление компонентов интеграции на виртуальных машинах. Новые компоненты интеграции были включены в узел Hyper-V, а затем устанавливались на виртуальных машинах с помощью файла vmguest.iso. Для этого процесса требовался перезапуск виртуальной машины. Кроме того, его невозможно было объединить с другими обновлениями Windows. Поскольку администратору Hyper-V требовалось предоставить файл vmguest.iso, а администратору виртуальных машин нужно было установить его, для обновления компонентов интеграции администратор Hyper-V должен был иметь учетные данные администратора виртуальных машин. А это требование соблюдается не всегда.
　　


В Windows 10 и дальнейших версиях все компоненты интеграции будут предоставляться виртуальным машинам через Центр обновления Windows, как и другие важные обновления.


Эти обновления сегодня доступны для виртуальных машин под управлением следующих ОС:
*  Windows Server 2012
*  Windows Server 2008 R2
*  Windows 8
*  Windows 7

Виртуальная машина должна быть подключена к Центру обновления Windows или серверу WSUS. В будущем обновления компонентов интеграции будут иметь идентификатор категории. Для данного выпуска они перечислены как статьи базы знаний.

Дополнительные сведения об определении применимости см. в этой [записи блога](http://blogs.technet.com/b/virtualization/archive/2014/11/24/integration-components-how-we-determine-windows-update-applicability.aspx).


Подробное пошаговое руководство по установке служб интеграции приводится в этой [записи блога](http://blogs.msdn.com/b/virtual_pc_guy/archive/2014/11/12/updating-integration-components-over-windows-update.aspx).


> **Внимание!** Файл ISO-образа vmguest.iso больше не требуется для обновления компонентов интеграции. Он не входит в Hyper-V в Windows 10.


## Следующий шаг

[Работа с Hyper-V в Windows 10](..\quick_start\walkthrough.md)



