# Экспорт и импорт виртуальных машин

Используя функции экспорта и импорта Hyper-V, можно быстро дублировать виртуальные машины. Экспорт виртуальных машин можно использовать для резервного копирования или для перемещения виртуальной машины между узлами Hyper-V.

Импорт позволяет восстановить виртуальную машину. Чтобы импортировать виртуальную машину, ее не обязательно экспортировать. Функция импорта будет пытаться воссоздать виртуальную машину из того, что доступно. Используйте мастер **импорта виртуальной машины**, чтобы указать расположение файлов. Виртуальная машина будет зарегистрирована в Hyper-V и станет доступной для использования.

В этом документе описано, как экспортировать и импортировать виртуальную машину, а также приведены некоторые параметры, которые можно выбрать при выполнении этих задач.

## Экспорт виртуальной машины

### Использование диспетчера Hyper-V

При экспорте виртуальной машины все связанные файлы объединены. К ним относятся файлы конфигурации, файлы жесткого диска, а также любые существующие файлы контрольных точек. Чтобы экспортировать виртуальную машину:

1. В диспетчере Hyper-V щелкните нужную виртуальную машину правой кнопкой мыши и выберите пункт **Экспорт**.

2. Укажите расположение для сохранения экспортированных файлов и нажмите кнопку **Экспортировать**.

**Примечание.** Этот процесс может выполняться для виртуальной машины как в запущенном, так и в остановленном состоянии.

После завершения экспорта можно увидеть все экспортированные файлы в указанном расположении.

### Использование PowerShell

Чтобы экспортировать виртуальную машину с помощью PowerShell, используйте команду **Export-VM**.

```powershell
Export-VM -Name <vm name> -Path <path>
```

Сведения об использовании Windows PowerShell для экспорта виртуальных машин см. в разделе [Экспорт виртуальной машины](https://technet.microsoft.com/library/hh848491.aspx).

## Импорт виртуальной машины

При импорте виртуальной машины она регистрируется на узле Hyper-V. Экспортированную виртуальную машину можно импортировать обратно в узел, из которого она была получена, или в новый узел.

Существует три типа импорта в Hyper-V.

- **Регистрация на месте**. Файлы экспорта перемещаются в расположение, из которого следует запускать виртуальную машину. При импорте идентификатор виртуальной машины такой же, как и при экспорте. Поэтому если виртуальная машина уже зарегистрирована в Hyper-V, ее необходимо удалить перед началом импорта. По окончании импорта файлы экспорта переходят в состояние выполнения и не могут быть удалены.

- **Восстановление виртуальной машины**. Можно сохранить файлы виртуальной машины в определенной папке или воспользоваться расположением по умолчанию для Hyper-V. В этом случае создается копия экспортируемого файла, которая перемещается в указанное расположение. При импорте идентификатор виртуальной машины такой же, как и при экспорте. Поэтому если виртуальная машина уже запущена в Hyper-V, ее необходимо удалить перед выполнением импорта. По окончании импорта исходные (экспортированные) файлы остаются нетронутыми, их можно удалить или импортировать снова.

- **Копирование виртуальной машины**. Этот тип импорта похож на тип восстановления тем, что вы выбираете расположение для файлов виртуальной машины. Разница в том, что при импорте у виртуальной машины новый идентификатор. Это позволяет импортировать виртуальную машину в один и тот же узел несколько раз.


### Использование диспетчера Hyper-V

Чтобы импортировать виртуальную машину в узел Hyper-V, выполните указанные ниже действия.

1. В диспетчере Hyper-V выберите в меню действий пункт **Импорт виртуальной машины**.

2. На экране "Приступая к работе" нажмите кнопку **Далее**.

3. Выберите папку, содержащую экспортированные файлы, и нажмите кнопку **Далее**.

4. Укажите виртуальную машину для импорта (вероятно, будет доступен только один вариант).

5. Выберите один из трех типов импорта и нажмите кнопку "Далее".

6. На экране сводки нажмите кнопку **Готово**.

Мастер импорта виртуальной машины также поможет выполнить действия по устранению несовместимостей при импорте виртуальной машины на новый узел. Таким образом, этот мастер позволит настроить конфигурацию, которая связана с физическим оборудованием, таким как память, виртуальные коммутаторы и виртуальные процессоры.

Чтобы импортировать виртуальную машину, мастер выполняет следующие задачи.
1. Создает копию файла конфигурации виртуальной машины. Это делается в качестве меры предосторожности на случай неожиданной перезагрузки на узле, возможной, например, после отключения питания.

2. Проверяет оборудование. Сведения в файле конфигурации виртуальной машины сравниваются с оборудованием на новом узле.

3. Компилирует список ошибок. В этом списке выявляются компоненты для перенастройки и определяются страницы, отображаемые далее в мастере.

4. Отображает соответствующие страницы — по одной категории за раз. В мастере дается объяснение каждой несовместимости, которое подсказывает, как изменить конфигурацию виртуальной машины так, чтобы она стала совместима с новым узлом.

5. Удаляет копию файла конфигурации. После выполнения этого действия виртуальная машина готова для запуска.


### Использование PowerShell

Чтобы импортировать виртуальную машину с помощью PowerShell, используйте команду **Import-VM**. Указанные ниже команды демонстрируют каждый из трех типов импорта с помощью PowerShell.

Чтобы выполнить импорт виртуальной машины на месте, используйте указанную ниже команду. Не забывайте, что при импорте на месте файлы используются в той папке, в которой они располагаются во время импорта, а идентификатор виртуальной машины сохраняется.

```powershell
Import-VM -Path 'C:\<emport path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' 
```

Чтобы импортировать виртуальную машину, указав собственный путь для ее файлов, используйте приведенную ниже команду.

```powershell
Import-VM -Path ‘C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' -Copy -VhdDestinationPath 'D:\Virtual Machines\WIN10DOC' -VirtualMachinePath 'D:\Virtual Machines\WIN10DOC'
```

Чтобы импортировать виртуальную машину с выполнением копирования и переместить ее файлы в расположение Hyper-V по умолчанию, используйте указанную ниже команду.

``` PowerShell
Import-VM -Path 'C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' -Copy -GenerateNewId
```

Дополнительные сведения см. в разделе [Импорт виртуальной машины](https://technet.microsoft.com/library/hh848495.aspx).





<!--HONumber=Feb16_HO4-->


