---
redirect_url: http://aka.ms/upgradevmconfig
---

# Миграция и обновление виртуальных машин

При перемещении на узел Windows 10 виртуальных машин, созданных с помощью Hyper-V в ОС Windows 8.1 или более ранней версии, новые функции будут недоступны, пока вы вручную не обновите версию конфигурации.

Чтобы обновить версию конфигурации, завершите работу виртуальной машины и выберите пункт "Обновить конфигурацию виртуальной машины" в диспетчере Hyper-V. Кроме того, можно открыть командную строку Windows PowerShell с повышенными привилегиями и ввести следующую команду:

 ```PowerShell
Update-VmVersion <vmname> | <vmobject>
 ```

## Как проверить версию конфигурации виртуальных машин на узле Hyper-V?

Чтобы узнать версию конфигурации, откройте командную строку Windows PowerShell с повышенными привилегиями и выполните следующую команду:

**Get-VM * | Format-Table Name, Version**

Команда PowerShell возвращает следующий пример выходных данных:

```
Name        State       CPUUsage(%) MemoryAssigned(M)   Uptime              Status                  Version

Atlantis    Running         0       1024                00:04:20.5910000    Operating normally      5.0

SGC VM      Running         0       538                 00:02:44.8350000    Operating normally      6.2
```


## Что будет, если не обновить версию конфигурации?

Если виртуальные машины созданы с помощью более ранней версии Hyper-V, некоторые новые функции будут недоступны до обновления версии.

Минимальная версия конфигурации виртуальной машины для новых функций Hyper-V:

| **Название функции**| **Минимальная версия виртуальной машины**| |
| :------------------------------------- | -----------------: ||
| Горячее добавление и удаление памяти| 6.0| |
| Горячее добавление и удаление сетевых адаптеров| 5.0| |
| Безопасная загрузка виртуальных машин Linux| 6.0| |
| Рабочие контрольные точки| 6.0| |
| PowerShell Direct| 6.2| |
| Виртуальный доверенный платформенный модуль (vTPM)| 6.2| |
| Группирование виртуальных машин| 6.2| |



## Версия конфигурации виртуальной машины

При перемещении или импорте виртуальной машины на узел с Hyper-V в Windows 10 с узла под управлением Windows 8.1 файл конфигурации виртуальной машины не обновляется автоматически. Это позволяет переместить виртуальную машину обратно на узел под управлением Windows 8.1. Новые функции виртуальной машины будут недоступны, пока вы вручную не обновите версию конфигурации виртуальной машины.

Версия конфигурации виртуальной машины указывает, с какой версией Hyper-V совместимы конфигурация, сохраненное состояние и файлы моментальных снимков виртуальной машины. Виртуальные машины с конфигурацией версии 5 совместимы с Windows 8.1 и могут работать в Windows 8.1 и Windows 10. Виртуальные машины с конфигурацией версии 6 совместимы с Windows 10 и не будут работать в Windows 8.1.

Обновлять все виртуальные машины одновременно необязательно. Их можно обновлять по мере необходимости. При этом новые функции виртуальной машины будут недоступны, пока вы вручную не обновите версию конфигурации.


----------------

**Важно! **

• После обновления версии конфигурации виртуальную машину невозможно переместить на узел под управлением Windows 8.1.

• После обновления конфигурации до версии 6 перейти на использование версии 5 невозможно.

• Чтобы обновить конфигурацию, виртуальную машину необходимо отключить.

• После обновления виртуальная машина использует новый формат файлов конфигурации. Дополнительные сведения см. в разделе "Новый формат файлов конфигурации виртуальной машины".

--------






## Что происходит при обновлении версии виртуальной машины?

При ручном обновлении конфигурации до версии 6.x изменяется структура файлов, которая используется для хранения файлов конфигурации и контрольных точек виртуальной машины.

Обновленные виртуальные машины используют новый формат файлов конфигурации, который повышает эффективность чтения и записи данных. Кроме того, при обновлении снижается вероятность повреждения данных в случае ошибки хранилища.

В таблице ниже указаны расположения двоичных файлов в обновленной виртуальной машине и сведения об их расширениях.

| **Файлы конфигурации и контрольных точек виртуальной машины (версии 6.x)**| **Описание**| |
|:---------------|:----------------||
| **Конфигурация виртуальной машины**| Сведения о конфигурации хранятся в двоичном файле с расширением .vmcx.| |
| **Состояние среды выполнения виртуальной машины**| Данные состояния среды выполнения хранятся в двоичном файле с расширением .vmrs.| |
| **Виртуальный жесткий диск виртуальной машины**| Файлы виртуального жесткого диска виртуальной машиныс расширением .vhd или .vhdx.| |
| **Файлы автоматических виртуальных жестких дисков**| Файлы разностных дисков, используемые для контрольных точек виртуальной машины,с расширением .avhdx.| |
| **Файлы контрольных точек**| Контрольные точки хранятся в нескольких файлах.Каждая контрольная точка создает файл конфигурации и файл состояния среды выполненияс расширениями .vmrs и .vmcx.Эти новые форматы файлов также используются для рабочих и стандартных контрольных точек.| |

После обновления конфигурации виртуальной машины до версии 6.x перейти на использование версии 5 невозможно.

Чтобы обновить конфигурацию, виртуальную машину необходимо отключить.

В таблице ниже указаны расположения файлов по умолчанию для новых или обновленных виртуальных машин.

| **Файлы виртуальной машины (версии 6.x)**| **Описание**| |
|:-----|:-----||
| **Файл конфигурации виртуальной машины**| C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines| |
| **Файл состояния среды выполнения виртуальной машины**| C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines| |
| **Файлы контрольных точек (.vmrs, .vmcx)**| C:\ProgramData\Microsoft\Windows\Snapshots| |
| **Файл виртуального жесткого диска (.vhd, .vhdx)**| C:\Users\Public\Documents\Hyper-V\Virtual Hard Disks| |
| **Файлы автоматических виртуальных жестких дисков (.avhdx)**| C:\Users\Public\Documents\Hyper-V\Virtual Hard Disks| |










<!--HONumber=May16_HO1-->


