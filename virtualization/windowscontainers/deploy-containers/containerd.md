---
title: Платформа контейнеров Windows
description: Дополнительные сведения о новых стандартных блоках контейнеров, доступных в Windows.
keywords: ЛКОВ, контейнеры Linux, Docker, контейнеры, контейнеры, CRI, рунхкс, рунк
author: scooley
ms.date: 11/19/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: a0e62b32-0c4c-4dd4-9956-8056e9abd9e5
ms.openlocfilehash: 74e22702aa4be30055b3f4f48c7fac926d793095
ms.sourcegitcommit: 1ca9d7562a877c47f227f1a8e6583cb024909749
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74909924"
---
# <a name="container-platform-tools-on-windows"></a>Инструменты платформы контейнеров в Windows

Платформа контейнеров Windows развернута! DOCKER является первой частью пути к контейнеру, теперь мы создаем другие инструменты платформы контейнеров.

* [контейнерный или CRI](https://github.com/containerd/cri) -новый в Windows Server 2019/Windows 10 1809.
* [рунхкс](https://github.com/Microsoft/hcsshim/tree/master/cmd/runhcs) — узел контейнера Windows, аналогичный рунк.
* [HCS](https://docs.microsoft.com/virtualization/api/) — Служба вычислений узлов и удобные оболочки, чтобы упростить ее использование.
  * [хксшим](https://github.com/microsoft/hcsshim)
  * [DotNet-компутевиртуализатион](https://github.com/microsoft/dotnet-computevirtualization)

В этой статье рассматривается платформа контейнеров Windows и Linux, а также все инструменты для платформы контейнеров.

## <a name="windows-and-linux-container-platform"></a>Платформа контейнеров Windows и Linux

В средах Linux такие средства управления контейнерами, как DOCKER, основаны на более детализированном наборе средств контейнеров: [рунк](https://github.com/opencontainers/runc) и [Container](https://containerd.io/).

![Архитектура DOCKER в Linux](media/docker-on-linux.png)

`runc` — это средство командной строки Linux для создания и запуска контейнеров в соответствии со [спецификацией времени выполнения контейнера OCI](https://github.com/opencontainers/runtime-spec).

`containerd` — это управляющая программа, которая управляет жизненным циклом контейнера от загрузки и распаковки образа контейнера до выполнения и контроля контейнеров.

В Windows мы сделали другой подход.  Когда мы начали работать с DOCKER для поддержки контейнеров Windows, мы создали непосредственно в HCS (Служба вычислений узлов).  [Эта запись блога](https://techcommunity.microsoft.com/t5/Containers/Introducing-the-Host-Compute-Service-HCS/ba-p/382332) заполнена информацией о том, почему мы создали HCS и зачем изначально использовался этот подход к контейнерам.

![Начальная архитектура подсистемы DOCKER в Windows](media/hcs.png)

На этом этапе DOCKER по-прежнему обращается непосредственно к HCS. Тем не менее, средства управления контейнерами расширяются для включения контейнеров Windows, и узел контейнера Windows может вызывать в контейнеры и рунхкс способ вызова в контейнерах и рунк в Linux.

## <a name="runhcs"></a>рунхкс

`runhcs` является вилкой `runc`.  Как и `runc`, `runhcs` — это клиент командной строки для запуска приложений, упакованных в соответствии с форматом Open Container Initiative (OCI), и является соответствующей реализацией спецификации инициативы Open Container.

К функциональным различиям между рунк и рунхкс относятся:

* `runhcs` работает в Windows.  Он взаимодействует с [HCS](containerd.md#hcs) для создания контейнеров и управления ими.
* `runhcs` могут запускать различные типы контейнеров.

  * [Изоляция Hyper-V](../manage-containers/hyperv-container.md) в Windows и Linux
  * Контейнеры процессов Windows (образ контейнера должен соответствовать узлу контейнера)

**Использование**.

``` cmd
runhcs run [ -b bundle ] <container-id>
```

`<container-id>` — это имя для запускаемого экземпляра контейнера. Имя должно быть уникальным на узле контейнера.

Каталог пакета (с использованием `-b bundle`) является необязательным.  
Как и в случае с рунк, контейнеры настраиваются с помощью пакетов. Пакет контейнера — это каталог с файлом спецификации OCI контейнера "config. JSON".  Значение по умолчанию для пакета — текущий каталог.

В файле спецификации OCI "config. JSON" должно быть два поля для правильной работы:

* Путь к области временного пространства контейнера
* Путь к каталогу слоя контейнера

Команды контейнера, доступные в рунхкс, включают:

* Средства для создания и запуска контейнера
  * **Run** создание и запуск контейнера
  * **Создание** контейнера

* Средства для управления процессами, выполняющимися в контейнере:
  * **Start** выполняет определяемый пользователем процесс в созданном контейнере
  * **exec** запускает новый процесс в контейнере.
  * **приостановить** приостановить все процессы в контейнере
  * **возобновление** возобновляет работу всех процессов, которые были приостановлены ранее
  * **PS** PS отображает процессы, выполняющиеся в контейнере.

* Средства для управления состоянием контейнера
  * **State** выводит состояние контейнера
  * **инструкция KILL** отправляет указанный сигнал (по умолчанию: SIGTERM) в процесс инициализации контейнера
  * **Delete** удаляет все ресурсы, удерживаемые контейнером, который часто используется с отключенным контейнером.

**Список**состоит из нескольких команд, которые можно считать несколькими контейнерами.  В нем перечисляются запущенные или приостановленные контейнеры, запущенные рунхкс с заданным корнем.

### <a name="hcs"></a>HCS

У нас есть две оболочки, которые можно использовать в GitHub для взаимодействия с HCS. Поскольку HCS представляет собой API C, оболочки упрощают вызов HCS из языков более высокого уровня.  

* [хксшим](https://github.com/microsoft/hcsshim) -хксшим пишется в Go и является основанием для рунхкс.
Завлеките последнюю версию из AppVeyor или создайте ее самостоятельно.
* [DotNet-компутевиртуализатион](https://github.com/microsoft/dotnet-computevirtualization) -DotNet-компутевиртуализатион — это C# оболочка для HCS.

Если вы хотите использовать HCS (напрямую или через оболочку) или хотите сделать оболочку Руст/Haskell/Инсертйоурлангуаже вокруг HCS, оставьте комментарий.

Чтобы более подробно рассмотреть HCS, просмотрите [презентацию том контрастной](https://www.youtube.com/watch?v=85nCF5S8Qok).

## <a name="containerdcri"></a>Контейнерный или CRI

> [!IMPORTANT]
> Поддержка CRI доступна только на сервере 2019/Windows 10 1809 и более поздних версиях.  Также все еще активно разрабатывается контейнер для Windows.
> Только для разработки и тестирования.

Хотя спецификации OCI определяют один контейнер, [CRI](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto) (интерфейс среды выполнения контейнера) описывает контейнеры как рабочие нагрузки в общей изолированной среде, называемой Pod.  Модули Pod могут содержать одну или несколько рабочих нагрузок контейнера.  Модули управления ресурсами позволяют оркестрации контейнеров, такие как Kubernetes и Service Fabric, обрабатывали сгруппированные рабочие нагрузки, которые должны находиться на одном узле с некоторыми общими ресурсами, такими как память и виртуальных сетей.

Контейнерный или CRI включает следующую матрицу совместимости для модулей Pod:

| ОС узла | Образ | Изоляция | Поддержка Pod? |
|:-------------------------------------------------------------------------|:-----------------------------------------------------------------------------|:---------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------|
| <ul><li>Windows Server 2019/1809</ul></li><ul><li>Windows 10 1809</ul></li> | Linux | `hyperv` | Да — поддерживает истинные модули Pod с несколькими контейнерами. |
|  | Windows Server 2019/1809 | `process`* или `hyperv` | Да — поддерживает истинные многоконтейнерные модули, если каждая ОС контейнера рабочей нагрузки соответствует служебной ОС виртуальной машины. |
|  | Windows Server 2016,</br>Windows Server 1709,</br>Windows Server 1803. | `hyperv` | Частично — поддерживает песочницы Pod, которые могут поддерживать один изолированный от процесса контейнер на виртуальную машину, если операционная система контейнера соответствует операционной системе виртуальной машины. |

узлы \*Windows 10 поддерживают только изоляцию Hyper-V

Ссылки на спецификацию CRI:

* Спецификация [рунподсандбокс](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto#L24) -Pod
* [CreateContainer](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto#L47) — спецификация рабочей нагрузки

![Контейнерные среды на основе контейнеров](media/containerd-platform.png)

Хотя Рунхкс и контейнеры могут управлять на любом сервере Windows System Server 2016 или более поздней версии, поддержка модулей Pod (групп контейнеров) требовала критически важных изменений в средствах контейнеров в Windows.  Поддержка CRI доступна в Windows Server 2019/Windows 10 1809 и более поздних версиях.
