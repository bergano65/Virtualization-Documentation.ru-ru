---
title: Платформа контейнера Windows
description: Узнайте больше о новых стандартных блоках контейнеров, доступных в Windows.
keywords: ЛКОВ, контейнеры Linux, стыковочные, контейнеры, контейнеры, CRI, рунхкс, рунк
author: scooley
ms.date: 11/19/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: a0e62b32-0c4c-4dd4-9956-8056e9abd9e5
ms.openlocfilehash: 3107eb48dc9c75224b0c9dd9b436af6f0f451871
ms.sourcegitcommit: cdf127747cfcb839a8abf50a173e628dcfee02db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2019
ms.locfileid: "9998421"
---
# <a name="container-platform-tools-on-windows"></a>Инструменты платформы контейнеров в Windows

Платформа контейнера Windows расширяется! Dock — это первый фрагмент контейнера, теперь мы создаем другие инструменты платформы контейнера.

* [контейнерный или CRI](https://github.com/containerd/cri) -новый в Windows Server 2019 и Windows 10 1809.
* [рунхкс](https://github.com/Microsoft/hcsshim/tree/master/cmd/runhcs) — узел контейнера Windows, являющийся аналогом для рунк.
* [ХКС](https://docs.microsoft.com/virtualization/api/) — служба COMPUTE Hosting Service + удобные оболочки для облегчения работы.
  * [хксшим](https://github.com/microsoft/hcsshim)
  * [DotNet — компутевиртуализатион](https://github.com/microsoft/dotnet-computevirtualization)

В этой статье рассказывается о платформе контейнеров Windows и Linux, а также о каждом средстве управления платформой.

## <a name="windows-and-linux-container-platform"></a>Платформа контейнеров для Windows и Linux

В средах Linux средства управления контейнерами, такие как Dock, строятся на основе более детального набора средств работы с контейнерами: [рунк](https://github.com/opencontainers/runc) и [Container](https://containerd.io/).

![Архитектура Dock в Linux](media/docker-on-linux.png)

`runc` — Это средство командной строки Linux для создания и запуска контейнеров в соответствии со [спецификацией среды выполнения контейнера OCI](https://github.com/opencontainers/runtime-spec).

`containerd` — Это демон, который управляет жизненным циклом контейнера из загрузки и распаковки изображения-контейнера для выполнения и контроля.

В Windows мы пользовались другим подходом.  Приступая к работе с стыковочным окном для поддержки контейнеров Windows, мы создали непосредственно на ХКС (служба COMPUTE Host Service).  В [этой записи блога](https://techcommunity.microsoft.com/t5/Containers/Introducing-the-Host-Compute-Service-HCS/ba-p/382332) подробно описана причина, по которой мы создали ХКС и почему мы решили, что этот подход изначально использовался для контейнеров.

![Начальная архитектура подстыковочных модулей в Windows](media/hcs.png)

На этом этапе стыковочный элемент по-прежнему вызывается непосредственно в ХКС. Однако пересылка средств управления контейнерами расширяется, чтобы включить контейнеры Windows, а узел контейнера Windows — на контейнер и рунхкс способ вызова для контейнеров и рунк в Linux.

## <a name="runhcs"></a>рунхкс

`runhcs` является вилкой `runc`.  Like `runc` `runhcs` — клиент командной строки для запуска приложений, упакованных в соответствии с форматом Open Container (OCI), и является совместимой реализацией спецификации инициативы Open Container.

Функциональные различия между рунк и рунхкс включают:

* `runhcs` работает в Windows.  Он связывается с [ХКС](containerd.md#hcs) для создания контейнеров и управления ими.
* `runhcs` может выполнять различные типы контейнеров.

  * [Изоляция Hyper-V](../manage-containers/hyperv-container.md) для Windows и Linux
  * Контейнеры процессов Windows (изображение контейнера должно совпадать с узлом контейнера)

**Использование:**

``` cmd
runhcs run [ -b bundle ] <container-id>
```

`<container-id>` — Это имя для экземпляра контейнера, который вы запускаете. Имя должно быть уникальным для вашего узла контейнера.

Каталог "набор (с `-b bundle`помощью)" является необязательным.  
Как и в рунк, контейнеры настраиваются с помощью пакетов. Набор контейнеров — это каталог с файлом спецификации OCI контейнера, config. JSON.  Значением по умолчанию для аргумента "набор" является текущий каталог.

Для правильного выполнения двух полей в файле спецификации OCI ("config. JSON") должно быть установлено два поля:

* Путь к рабочей области контейнера
* Путь к каталогу слоев контейнера

Команды контейнера, доступные в рунхкс, включают:

* Средства для создания и запуска контейнера
  * **Run** создание и запуск контейнера
  * **Создание** контейнера

* Инструменты для управления процессами, выполняемыми в контейнере:
  * **Start** выполняет процесс, определяемый пользователем, в созданном контейнере
  * **exec** запускает новый процесс внутри контейнера.
  * **Pause** Pause приостанавливает все процессы в контейнере.
  * **возобновление** возобновляет работу всех процессов, которые уже были приостановлены.
  * **PS** PS показывает процессы, которые выполняются в контейнере.

* Инструменты для управления состоянием контейнера
  * **State** выводит состояние контейнера
  * **Kill** отправляет указанный сигнал (по умолчанию: сигтерм) процессу инициализации контейнера.
  * **Delete** удаляет все ресурсы, удерживаемые контейнером, которые часто используются с отсоединенным контейнером

**Список**, который можно рассматривать как множественный контейнер.  Он содержит список запущенных и приостановленных контейнеров, запущенных рунхкс с указанным корнем.

### <a name="hcs"></a>хкс

У нас есть две оболочки, которые можно использовать в GitHub для взаимодействия с ХКС. Поскольку ХКС является API C, обертки упрощают вызов ХКС из языков с более высоким уровнем.  

* [хксшим](https://github.com/microsoft/hcsshim) -хксшим пишется в Go и является основой для рунхкс.
Завлеките последнюю версию из Аппвэйор или создайте ее самостоятельно.
* [DotNet — компутевиртуализатион](https://github.com/microsoft/dotnet-computevirtualization) -DotNet-компутевиртуализатион — это обертка C# для ХКС.

Если вы хотите использовать ХКС (напрямую или через обертку) или хотите создать обертку Руст/Хаскелл/Инсертйоурлангуаже вокруг ХКС, пожалуйста, оставьте комментарий.

Для более глубокого взгляда на ХКС просмотрите [доккеркон презентацию John резкий](https://www.youtube.com/watch?v=85nCF5S8Qok).

## <a name="containerdcri"></a>Контейнерный или CRI

> [!IMPORTANT]
> Служба поддержки CRI доступна только на сервере 2019 (Windows 10 1809 и более поздние версии).  Кроме того, мы по-прежнему работаем над разработкой в контейнере для Windows.
> Только для разработки и тестирования.

Несмотря на то, что спецификации OCI определяют один контейнер, [CRI](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto) (интерфейс контейнера среды выполнения) описывает контейнеры в качестве рабочих нагрузок в общей изолированной среде, называемой Pod.  В обыкновенных работах может быть один или несколько рабочих нагрузок контейнера.  Обыкновенные ресурсы, такие как Кубернетес и Сетчатая структура, обрабатывают сгруппированные рабочие нагрузки, которые должны располагаться на одном и том же узле с некоторыми общими ресурсами, такими как память и Внетс.

контейнеры и CRI включают следующую матрицу совместимости для форматов файлов.

| Хост OS | ОС контейнера | Привод | Поддержка Pod |
|:-------------------------------------------------------------------------|:-----------------------------------------------------------------------------|:---------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------|
| <ul><li>Windows Server 2019/1809</ul></li><ul><li>Windows 10 1809</ul></li> | Linux | `hyperv` | Да — поддерживает истинные множественные многоконтейнерные обыкновения. |
|  | Windows Server 2019/1809 | `process`* или `hyperv` | Да — поддерживает истинные множественные многоконтейнерные значения, если каждая операционная система контейнера рабочей нагрузки соответствует служебной операционной системе виртуальной машины. |
|  | Windows Server 2016,</br>Windows Server 1709,</br>Windows Server 1803 | `hyperv` | Partial (частично) — поддерживает изолированные программы Pod, которые могут поддерживать один изолированный от процесса контейнер на виртуальную машину, если ОС контейнера соответствует служебной операционной системе виртуальной машины. |

\ * Узлы Windows 10 поддерживают только изоляцию Hyper-V.

Ссылки на спецификацию CRI:

* Спецификация [рунподсандбокс](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto#L24) -Pod
* [Креатеконтаинер](https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto#L47) — спецификация рабочей нагрузки

![Контейнерные среды на основе контейнеров](media/containerd-platform.png)

Несмотря на то, что Рунхкс и контейнеры могут управлять на любом системном сервере Windows 2016 или более поздней версии, поддерживающих Обыкновенности (группы контейнеров), требуется коренные изменения в инструментах контейнера в Windows.  Служба поддержки CRI доступна в Windows Server 2019/Windows 10 1809 и более поздних версиях.
