---
title: Постоянное хранилище в контейнерах
description: Как контейнеры Windows могут хранить постоянное хранилище
keywords: контейнеры, том, хранилище, подключение, подключение с привязкой
author: cwilhit
ms.openlocfilehash: 945a78d4ecb9c96da4de8f7246f84b6b444dd5b5
ms.sourcegitcommit: 1ca9d7562a877c47f227f1a8e6583cb024909749
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74909674"
---
# <a name="persistent-storage-in-containers"></a>Постоянное хранилище в контейнерах

<!-- Great diagram would be great! -->

В некоторых случаях важно, чтобы приложение могло сохранять данные в контейнере, или вы хотите показывать файлы в контейнере, который не включался во время сборки контейнера. Постоянное хранилище можно предоставить контейнерам двумя способами:

- Привязки подключений
- именованные тома.

В документации Docker доступен отличный обзор [использования томов](https://docs.docker.com/engine/admin/volumes/volumes/), так что сначала лучше прочитать его. Остальная часть этого документа посвящена различиям между Linux и Windows и примерам для Windows.

## <a name="bind-mounts"></a>Привязки подключений

[Привязка подключения](https://docs.docker.com/engine/admin/volumes/bind-mounts/) позволяет контейнеру использовать каталог совместно с узлом. Это полезно, если требуется место для хранения файлов на локальном компьютере, которые доступны при перезапуске контейнер, или если необходимо совместно использовать их с несколькими контейнерами. Чтобы запустить контейнер на нескольких компьютерах с доступом к тем же файлам, следует использовать именованный том или SMB-подключение.

### <a name="permissions"></a>Разрешения

Модель разрешений, используемая для привязки подключений зависит от уровня изоляции контейнера.

Контейнеры, использующие **изоляцию Hyper-V** , используют простую модель разрешений только для чтения или для чтения и записи. Доступ к файлам на узле осуществляется с помощью учетной записи `LocalSystem`. Если вам отказано в доступе в контейнере, убедитесь, что у `LocalSystem` есть доступ к каталогу на узле. Если используется флаг только для чтения, изменения, внесенные на томе внутри контейнера, не будут отображаться или сохраняться для каталога на узле.

Контейнеры Windows, использующие **изоляцию процессов** , немного отличаются, так как они используют удостоверение процесса в контейнере для доступа к данным, то есть учитываются списки управления доступом к файлам. Идентификатор процесса, выполняемого в контейнере (по умолчанию «ContainerAdministrator» в Windows Server Core и «ContainerUser» в контейнерах Nano Server) будет использоваться для доступа к файлам и каталогам на подключенном томе вместо `LocalSystem`, и ему потребуется предоставить доступ для использования данных.

Так как эти удостоверения существуют только в контексте контейнера, а не на узле, где хранятся файлы, следует использовать хорошо известную группу безопасности, например `Authenticated Users` при настройке списков управления доступом для предоставления доступа к контейнерам.

> [!WARNING]
> Не используйте привязку подключения конфиденциальных каталогов, таких как `C:\`, в недоверенных контейнерах. Это позволит ему изменить файлы на узле, к которым обычно нет доступа, и может создать брешь в системе безопасности.

Пример использования:

- `docker run -v c:\ContainerData:c:\data:RO` доступ только для чтения
- `docker run -v c:\ContainerData:c:\data:RW` доступ для чтения и записи
- `docker run -v c:\ContainerData:c:\data` доступ для чтения и записи (по умолчанию)

### <a name="symlinks"></a>Символические ссылки

Символические ссылки разрешаются в контейнере. При привязке подключения пути узла к контейнеру, который является символической ссылкой или содержит символическую ссылку, у контейнера не будет доступа к этим ресурсам.

### <a name="smb-mounts"></a>SMB-подключения

В Windows Server версии 1709 и более поздних компонент под названием «Глобальное сопоставление SMB» позволяет подключить общий ресурс SMB на узле, а затем передать каталоги в этой общей папке в контейнер. Контейнер не требуется настраивать с определенным сервером, общим ресурсом, именем пользователя или паролем — все данные обрабатываются на узле. Контейнер будет работать так же, как если бы он был локальным хранилищем.

#### <a name="configuration-steps"></a>Этапы настройки

1. На узле контейнера глобально сопоставьте удаленную общую папку SMB.
    ```
    $creds = Get-Credential
    New-SmbGlobalMapping -RemotePath \\contosofileserver\share1 -Credential $creds -LocalPath G:
    ```
    Эта команда будет использовать учетные данные для проверки подлинности на удаленном SMB Server. Затем сопоставьте путь к удаленной общей папке с буквой диска G: (или любой другой доступной буквой диска). Контейнеры, созданные на этом узле контейнера, теперь могут сопоставить свои тома данных с путем на диске G:.

    > [!NOTE]
    > При использовании глобального сопоставления SMB для контейнеров все пользователи на узле контейнера могут получить доступ к удаленной общей папке. Все приложения, работающие на узле контейнера, также получат доступ к сопоставленной удаленной общей папке.

2. Создайте контейнеры с томами данных, сопоставленными с глобально подключенным общим ресурсом SMB: docker run -it --name demo -v g:\ContainerData:G:\AppData1 microsoft/windowsservercore:1709 cmd.exe

    Внутри контейнера папка G:\AppData1 будет сопоставлена с каталогом «ContainerData» удаленной общей папки. Все данные, хранящиеся в глобально сопоставленной удаленной общей папке, будут доступны в приложениях внутри контейнера. Несколько контейнеров могут получить доступ к общим данным для чтения и записи с помощью одной команды.

Такая поддержка глобального сопоставления SMB является клиентской функцией SMB, которая может работать на любом совместимом SMB-сервере, в том числе:

- масштабируемый файловый сервер на базе локальных дисковых пространств (S2D) или традиционного хранилища SAN;
- файлы Azure (общий ресурс SMB);
- традиционный файловый сервер;
- сторонняя реализация протокола SMB (например: устройств NAS).

> [!NOTE]
> Глобальное сопоставление SMB не поддерживает общие папки DFS, DFSN, DFSR в Windows Server версии 1709.

## <a name="named-volumes"></a>Именованные тома

Именованные тома позволяют создать том по имени, назначить его контейнеру и повторно использовать его повторно с тем же именем. Вам не требуется отслеживать фактический путь его создания, а только имя. Подсистема Docker в Windows использует встроенный подключаемый модуль именованных томов, который может создавать тома на локальном компьютере. Если вы хотите использовать именованный тома на нескольких компьютерах, дополнительные подключаемый модуль не требуется.

Примеры:

1. `docker volume create unwound` создать том с именем "Unwound"
2. `docker run -v unwound:c:\data microsoft/windowsservercore`. Запуск контейнера с томом, сопоставленным с c:\Data
3. Запись некоторых файлов в каталог c:\data в контейнере, а затем остановка работы контейнера.
4. `docker run -v unwound:c:\data microsoft/windowsservercore`-запустить новый контейнер
5. Выполнение `dir c:\data` в новом контейнере —- файлы по-прежнему там.

> [!NOTE]
> Windows Server будет преобразовывать целевые пути (путь внутри контейнера) в нижний регистр; i. e. `-v unwound:c:\MyData`или `-v unwound:/app/MyData` в контейнерах Linux приведет к созданию каталога внутри контейнера `c:\mydata`или `/app/mydata` в контейнерах Linux, сопоставленных (и создаваемых, если они не существуют).
