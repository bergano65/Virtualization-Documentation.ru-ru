---
title: "Начало работы с режимом мелких объектов"
description: "Инициализация кластера мелких объектов, создание сети наложения и привязка службы к сети."
keywords: "docker, контейнеры, управление группой мелких объектов"
author: kallie-b
ms.date: 02/9/2017
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 5ceb9626-7c48-4d42-81f8-9c936595ad85
translationtype: Human Translation
ms.sourcegitcommit: f615c6dd268932a2ff99ac12c4e9ffdcf2cc217e
ms.openlocfilehash: ee6053003b31f226d2cfba8566f274ccc19d97ec
ms.lasthandoff: 03/02/2017

---

# Начало работы с режимом мелких объектов 

**Важное примечание.** *В настоящее время режим мелких объектов и сеть наложения доступны только [участникам программы предварительной оценки Windows](https://insider.windows.com/) в рамках предстоящего обновления Windows 10 Creators Update. Поддержка для других платформ Windows станет доступна в ближайшее время.*

## Что такое «режим мелких объектов»?
Режим мелких объектов — это функция Docker, которая предоставляет встроенные возможности управление контейнерами, в том числе кластеризацию узлов Docker и планирование рабочих нагрузок контейнера. Группа узлов Docker формирует кластер «мелких объектов», когда их модули Docker работают вместе в «режиме мелких объектов». Дополнительные сведения о режиме мелких объектов см. в [на основном сайте документации Docker](https://docs.docker.com/engine/swarm/).

## Управляющие узлы и рабочие узлы
Группа мелких объектов состоит из двух типов узлов контейнера: *управляющих узлов* и *рабочих узлов*. Каждая группа мелких объектов инициализируется через управляющий узел, при этом все команды интерфейса командной строки Docker для мониторинга группы мелких объектов и управления ей должны выполняться с одного из управляющих узлов. Управляющие узлы можно рассматривать как «хранителей» состояния группы мелких объектов — вместе они формируют группу согласия, которая предоставляет сведения о состоянии служб, запущенных в группе мелких объектов. Их задача — убедиться, что фактическое состояние группы мелких объектов всегда соответствует желаемому состоянию, заданному разработчиком или администратором. 

>    **Примечание.** В любой группе мелких объектов может быть несколько управляющих узлов, но в каждой группе должен быть *по крайней мере один такой узел*. 

Рабочие узлы управляются группой мелких объектов Docker посредством управляющих узлов. Чтобы присоединиться к группе мелких объектов, рабочий узел должен использовать «маркер присоединения», созданный с управляющего узла при инициализации группы мелких объектов. Рабочие узлы просто получают и выполняют задачи от управляющих узлов, поэтому для них не требуется информация о состоянии группы мелких объектов.

## Системные требования для режима мелких объектов

По крайней мере одна физическая или виртуальная компьютерная система (для использования всех функций группы мелких рекомендуется хотя бы два узла) с установленным **обновлением Windows 10 Creators Update** (доступно участникам [программы предварительной оценки Windows](https://insider.windows.com/)), настроенная как узел контейнера (дополнительные сведения о том, как приступить к работе с контейнерами Docker в Windows 10 см. в разделе [Контейнеры Windows в Windows 10](https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/quick-start-windows-10)).

**Модуль Docker 1.13.0 или более поздней версии**

Открытые порты: следующие порты должны быть доступны на каждом узле. В некоторых системах эти порты по умолчанию открыты.
- TCP-порт 2377 для управления кластером
- Порт TCP и UDP 7946 для связи между узлами
- Порт TCP и UDP 4789 для трафика сети наложения

## Инициализация кластера мелких объектов
Чтобы инициализировать группу мелких объектов, просто выполните следующую команду на одном из узлов контейнера (заменив \<HOSTIPADDRESS\> на локальный IPv4-адрес хост-компьютера):

```none
# Initialize a swarm 
C:\> docker swarm init --advertise-addr=<HOSTIPADDRESS> --listen-addr <HOSTIPADDRESS>:2377
```
После выполнения этой команды на узле контейнера модуль Docker на нем начинает работать в режиме мелких объектов в качестве управляющего узла.

## Добавление узлов в группу мелких объектов

> **Примечание.** Для использования режима мелких объектов и функций сети наложения *не* требуются несколько узлов. Все функции группы мелких объектов и сети наложения доступны при наличии одного узла, работающего в режиме мелких объектов (т. е. управляющего узла, переведенного в режим мелких объектов с помощью команды `docker swarm init`).

### Добавление рабочих узлов в группу мелких объектов
После инициализации группы мелких объектов управляющим узлом в нее можно добавить рабочие узлы с помощью другой простой команды:

```none
C:\> docker swarm join --token <WORKERJOINTOKEN> <MANAGERIPADDRESS>
```

Здесь \<MANAGERIPADDRESS\> — это локальный IP-адрес управляющего узла группы мелких объектов, а \<WORKERJOINTOKEN\> — это маркер присоединения рабочего узла из выходных данных команды `docker swarm init`, которая была выполнена на управляющем узле. Маркер присоединения также можно получить, выполнив одну из следующих команд на управляющем узле после инициализации группы мелких объектов:

```none
# Get the full command required to join a worker node to the swarm
C:\> docker swarm join-token worker

# Get only the join-token needed to join a worker node to the swarm
C:\> docker swarm join-token worker -q
```

### Добавление управляющих узлов в группу мелких объектов
Дополнительные управляющие узлы можно добавить в кластер мелких объектов с помощью следующей команды:

```none
C:\> docker swarm join --token <MANAGERJOINTOKEN> <MANAGERIPADDRESS>
```

Опять же, \<MANAGERIPADDRESS\> — это локальный IP-адрес управляющего группы мелких объектов. Маркер присоединения, \<MANAGERJOINTOKEN\> — это маркер присоединения *управляющего узла* для группы мелких объектов, который можно получить, выполнив одну из следующих команд на существующем управляющем узле:

```none
# Get the full command required to join a **manager** node to the swarm
C:\> docker swarm join-token manager

# Get only the join-token needed to join a **manager** node to the swarm
C:\> docker swarm join-token manager -q
```

## Создание сети наложения

После настройки кластера мелких объектов можно создать сети наложения. Для этого выполните следующую команду на управляющем узле группы мелких объектов:

```none
# Create an overlay network 
C:\> docker network create --driver=overlay <NETWORKNAME>
```

Здесь \<NETWORKNAME\> — это имя вашей сети.

## Развертывание служб в группе мелких объектов
После создания сети наложение можно создать службы и привязать их к сети. Сеть создается с помощью следующего синтаксиса:

```none
# Deploy a service to the swarm
C:\> docker service create --name=<SERVICENAME> --endpoint-mode dnsrr --network=<NETWORKNAME> <CONTAINERIMAGE> [COMMAND] [ARGS…]
```

Здесь \<SERVICENAME\> — это имя службы, которое будет использоваться для ссылки на службу при обнаружении служб (для чего применяется собственный DNS-сервер Docker). \<NETWORKNAME\> — это имя сети, к которой следует подключить эту службу (например, «myOverlayNet»). \<CONTAINERIMAGE\> — это имя образа контейнера, в котором будет определена служба.

> **Примечание.** Второй аргумент этой команды, `--endpoint-mode dnsrr`, необходим, чтобы указать модулю Docker, что для балансировки сетевого трафика между конечными точками контейнера службы будет использоваться политика циклического перебора DNS. Сейчас циклический перебор DNS — единственная стратегия балансировки, поддерживаемая в Windows. [Сетка маршрутизации](https://docs.docker.com/engine/swarm/ingress/) для узлов Docker в Windows не поддерживается, но эта возможность будет добавлена в ближайшее время. Пользователи, которым требуется другая стратегия балансировки, могут установить внешнюю подсистему балансировки нагрузки (например, NGINX) и использовать [режим публикации порта](https://docs.docker.com/engine/reference/commandline/service_create/#/publish-service-ports-externally-to-the-swarm--p---publish) группы мелких объектов для предоставления доступа к портам узла контейнера, для которого требуется балансировка нагрузки.

## Масштабирование службы
После развертывания службы в кластере мелких объектов экземпляры контейнера, из которых она состоит, развертываются в кластере. По умолчанию количество экземпляров контейнера, поддерживающих службу (число «реплик» или «задач» для службы) равно одному. Тем не менее службу можно создать с несколькими задачами, используя параметр `--replicas` для команды `docker service create` или масштабируя службу после ее создания.

Масштабируемость службы — важное преимущество Docker Swarm, и им можно воспользоваться с помощью одной команды Docker:

```none
C:\> docker service scale <SERVICENAME>=<REPLICAS>
```

Здесь \<SERVICENAME\> — имя масштабируемой службы, а \<REPLICAS\> — это число задач или экземпляров контейнера, до которого масштабируется служба.

## Просмотр состояния группы мелких объектов

Существует несколько полезных команд для просмотра состояния группы мелких объектов и служб, запущенных в ней.

### Перечисление узлов группы мелких объектов
Выполните следующую команду, чтобы просмотреть список узлов, присоединенных к группе мелких объектов, включая сведения о состоянии каждого узла. Эту команда необходимо выполнить на **управляющем узле**.

```none
C:\ docker node ls
```

В выходных данных этой команды можно заметить, что один из узлов помечен звездочкой (*). Этот символ просто обозначает текущий узел, на котором была выполнена команда `docker node ls`.

### Перечисление сетей
Выполните следующую команду, чтобы просмотреть список сетей на заданном узле. Для просмотра сетей наложения эту команда следует выполнить на **управляющем узле**, работающем в режиме мелких объектов.

```none
C:\ docker network ls
```

### Перечисление служб
Выполните следующую команду, чтобы просмотреть список служб, запущенных в группе мелких объектов, а также сведения об их состоянии.

```none
C:\ docker service ls
```

### Перечисление экземпляров контейнера, которые определяют службу
Выполните следующую команду, чтобы просмотреть сведения об экземплярах контейнера, запущенных для указанной службы. В выходные данные этой команды включены идентификаторы и узлы, на которых работает каждый контейнер, а также информация о состоянии контейнеров.  

```none
C:\ docker service ps <SERVICENAME>
```

## Ограничения
Сейчас режим мелких объектов режим в Windows имеет следующие ограничения.
- ИЗВЕСТНАЯ ОШИБКА: сети наложения и режим мелких объектов в настоящее время поддерживаются только на узлах контейнера, подключенных по Ethernet. **Они не будут работать с узлами, подключенными по Wi-Fi.** Мы работаем над решением этой проблемы.
- Шифрование плоскости данных не поддерживается (т. е. трафика между контейнерами с использованием параметра `--opt encrypted`).
- [Сетка маршрутизации](https://docs.docker.com/engine/swarm/ingress/) для узлов Docker в Windows пока не поддерживается, но эта возможность будет добавлена в ближайшее время. Пользователи, которым требуется другая стратегия балансировки, могут установить внешнюю подсистему балансировки нагрузки (например, NGINX) и использовать [режим публикации порта](https://docs.docker.com/engine/reference/commandline/service_create/#/publish-service-ports-externally-to-the-swarm--p---publish) группы мелких объектов для предоставления доступа к портам узла контейнера, для которого требуется балансировка нагрузки.  



