---
title: Режимы изоляции
description: Объясняется, как изоляция Hyper-V отличается от изолированных контейнеров процессов.
keywords: docker, контейнеры
author: crwilhit
ms.date: 09/26/2019
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 42154683-163b-47a1-add4-c7e7317f1c04
ms.openlocfilehash: fa95ffe1c699a2c837076fcc1b662f6b792b7dfb
ms.sourcegitcommit: 1ca9d7562a877c47f227f1a8e6583cb024909749
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74909754"
---
# <a name="isolation-modes"></a>Режимы изоляции

Контейнеры Windows предлагают два разных режима изоляции среды выполнения: `process` и `Hyper-V` изоляция. Контейнеры, работающие в обоих режимах изоляции, создаются, управляются и функционируют одинаково. Они также создают и используют одни и те же образы контейнера. Различие между режимами изоляции заключается в том, какая степень изоляции создается между контейнером, операционной системой узла и всеми другими контейнерами, работающими на этом узле.

## <a name="process-isolation"></a>Изоляция процессов

Это режим изоляции "традиционный" для контейнеров и описан в [обзоре контейнеров Windows](../about/index.md). При изоляции процессов несколько экземпляров контейнеров выполняются параллельно на данном узле с изоляцией, предоставляемой через пространство имен, управление ресурсами и технологии изоляции процессов. При работе в этом режиме контейнеры совместно используют один и тот же ядро вместе с узлом.  Это приблизительно то же самое, что и работа контейнеров Linux.

![](media/container-arch-process.png)

## <a name="hyper-v-isolation"></a>Изоляция Hyper-V
Этот режим изоляции обеспечивает повышенную безопасность и более широкие возможности обеспечения совместимости между версиями узлов и контейнеров. При использовании изоляции Hyper-V несколько экземпляров контейнеров одновременно выполняются на узле. Однако каждый контейнер выполняется в высокооптимизированной виртуальной машине и эффективно получает собственный ядро. Наличие виртуальной машины обеспечивает изоляцию аппаратного уровня между каждым контейнером, а также узлом контейнера.

![](media/container-arch-hyperv.png)

## <a name="isolation-examples"></a>Примеры изоляции

### <a name="create-container"></a>Создание контейнера

Управление изолированными контейнерами Hyper-V с помощью DOCKER практически идентично управлению изолированными контейнерами процессов. Чтобы создать контейнер с помощью полной изоляции Hyper-V, используйте параметр `--isolation`, чтобы задать `--isolation=hyperv`.

```cmd
docker run -it --isolation=hyperv mcr.microsoft.com/windows/servercore:ltsc2019 cmd
```

Чтобы создать контейнер с изоляцией процессов в режиме полного DOCKER, используйте параметр `--isolation`, чтобы задать `--isolation=process`.

```cmd
docker run -it --isolation=process mcr.microsoft.com/windows/servercore:ltsc2019 cmd
```

Контейнеры Windows, работающие в Windows Server по умолчанию, выполняются с изоляцией процессов. Контейнеры Windows, работающие в Windows 10 Pro и Enterprise по умолчанию, работают с изоляцией Hyper-V. Начиная с обновления Windows 10 октября 2018 г. Пользователи, работающие на узле Windows 10 Pro или Enterprise, могут запускать контейнер Windows с изоляцией процесса. Пользователи должны напрямую запрашивать изоляцию процесса с помощью флага `--isolation=process`.

> [!WARNING]
> Работа с изоляцией процессов в Windows 10 Pro и Enterprise предназначена для разработки и тестирования. Узел должен работать под управлением Windows 10 Build 17763 +, и у вас должна быть версия DOCKER с ядром 18,09 или более поздней версии.
> 
> Следует продолжать использовать Windows Server в качестве узла для развертывания в рабочей среде. Используя эту функцию в Windows 10 Pro и Enterprise, необходимо также убедиться, что теги версии узла и контейнера совпадают, иначе контейнер может не запуститься или открыть неопределенное поведение.

### <a name="isolation-explanation"></a>Пояснения по изоляции

В этом примере демонстрируются различия в возможностях изоляции между процессом и изоляцией Hyper-V.

Здесь развернут контейнер, изолированный от процессов, и будет размещаться длительно выполняющийся процесс проверки связи.

``` cmd
docker run -d mcr.microsoft.com/windows/servercore:ltsc2019 ping localhost -t
```

С помощью команды `docker top` процесс ping возвращается в том виде, который он имеет внутри контейнера. В этом примере процесс имеет идентификатор 3964.

``` cmd
docker top 1f8bf89026c8f66921a55e773bac1c60174bb6bab52ef427c6c8dbc8698f9d7a

3964 ping
```

На узле контейнера команду `get-process` можно использовать для возврата любых выполняющихся там процессов ping. В этом примере присутствует один такой процесс, идентификатор которого совпадает с идентификатором процесса из контейнера. Из контейнера и с узла виден один и тот же процесс.

```
get-process -Name ping

Handles  NPM(K)    PM(K)      WS(K) VM(M)   CPU(s)     Id  SI ProcessName
-------  ------    -----      ----- -----   ------     --  -- -----------
     67       5      820       3836 ...71     0.03   3964   3 PING
```

В этом примере также запускается контейнер Hyper-V-солатед с процессом проверки связи.

```
docker run -d --isolation=hyperv mcr.microsoft.com/windows/servercore:ltsc2019 ping localhost -t
```

Как и прежде, команда `docker top` позволяет вернуть выполняемые процессы из контейнера.

```
docker top 5d5611e38b31a41879d37a94468a1e11dc1086dcd009e2640d36023aa1663e62

1732 ping
```

Однако при поиске процесса на узле контейнера процесс проверки связи не найден, и выдается ошибка.

```
get-process -Name ping

get-process : Cannot find a process with the name "ping". Verify the process name and call the cmdlet again.
At line:1 char:1
+ get-process -Name ping
+ ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (ping:String) [Get-Process], ProcessCommandException
    + FullyQualifiedErrorId : NoProcessFoundForGivenName,Microsoft.PowerShell.Commands.GetProcessCommand
```

При этом на узле виден процесс `vmwp`, который является виртуальной машиной, инкапсулирующей запущенный контейнер и защищающей выполняющиеся процессы от операционной системы сервера виртуальных машин.

```
get-process -Name vmwp

Handles  NPM(K)    PM(K)      WS(K) VM(M)   CPU(s)     Id  SI ProcessName
-------  ------    -----      ----- -----   ------     --  -- -----------
   1737      15    39452      19620 ...61     5.55   2376   0 vmwp
```
