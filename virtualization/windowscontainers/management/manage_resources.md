



# Управление ресурсами контейнера

**Это предварительное содержимое. Возможны изменения.**

Вы можете управлять тем объемом ресурсов, который контейнеры Windows используют (это относится к ЦП, дисковым операциям ввода-вывода, сети и памяти). Ограничение этого объема делает возможным эффективное использование ресурсов узла и не допускает их перерасход. В этом документе подробно описано управление ресурсами контейнера с помощью PowerShell и Docker.

## Управление ресурсами с помощью PowerShell

### Память

При создании контейнера с помощью параметра `-MaximumMemoryBytes` в команде `New-Container` можно ограничить объем памяти этого контейнера. В этом примере задан максимальный объем памяти в размере 256 МБ)

```powershell
PS C:\> New-Container -Name TestContainer -MaximumMemoryBytes 256MB -ContainerimageName WindowsServerCore
```
Предельный объем памяти для уже существующего контейнера можно задать с помощью командлета `Set-ContainerMemory`.

```powershell
PS C:\> Set-ContainerMemory -ContainerName TestContainer -MaximumBytes 256mb
```

### Полоса пропускания сети

Для существующего контейнера можно задать ограничения на полосу пропускания сети. Для этого сначала убедитесь, что у контейнера есть сетевой адаптер, использовав команду `Get-ContainerNetworkAdapter`. Если сетевого адаптера нет, создайте его с помощью команды `Add-ContainerNetworkAdapter`. Наконец, используйте команду `Set-ContainerNetworkAdapter`, чтобы ограничить у этого контейнера пропускную способность сети для исходящего трафика.

В примере ниже установлена максимальная пропускная способность в размере 100 Мбит/с.

```powershell
PS C:\> Set-ContainerNetworkAdapter -ContainerName TestContainer -MaximumBandwidth 100000000
```

### ЦП

Вы можете ограничить объем вычислений для контейнера, задав максимальный процент ресурсов ЦП или относительный вес контейнера. Сочетание этих двух схем управления ЦП возможно, но не рекомендуется. По умолчанию для всех контейнеров задано полное использование процессора (до 100 %) и относительный вес в размере 100.

В примере ниже задается относительный вес контейнера в размере 1000. Вес контейнера по умолчанию равен 100, так что у контейнера из примера 10-кратный приоритет перед ним. Максимальное значение составляет 10 000.

```powershell
PS C:\> Set-ContainerProcessor -ContainerName Container1 -RelativeWeight 10000
```

Кроме того, можно задать жесткое ограничение на объем ресурсов ЦП, который контейнер может использовать за долю времени ЦП. По умолчанию контейнер может использовать 100 % ресурсов ЦП. В примере ниже контейнер может использовать максимум до 30 % ресурсов ЦП. При использовании флага -Maximum параметру RelativeWeight автоматически присваивается значение 100.

```powershell
PS C:\> Set-ContainerProcessor -ContainerName Container1 -Maximum 30
```

### Операции ввода-вывода для хранилища

Чтобы ограничить операции ввода-вывода для контейнера, задайте максимальную полосу пропускания (в байтах за секунду) или укажите количество таких операций в секунду из расчета, что при одной операции передается 8 КБ данных. Можно установить оба этих параметра вместе. Регулирование происходит при достижении любого из этих двух ограничений.

```powershell
PS C:\> Set-ContainerStorage -ContainerName Container1 -MaximumBandwidth 1000000
```
```powershell
PS C:\> Set-ContainerStorage -ContainerName Container1 -MaximumIOPS 32
```

## Управление ресурсами с помощью Docker

Мы предлагаем возможность управлять подмножеством ресурсов контейнера с использованием Docker. В частности, мы даем пользователям возможность указать, как контейнеры совместно используют ЦП.

### ЦП

Во время работы при помощи флага --cpu-shares можно управлять долей времени ЦП для обслуживания контейнеров. По умолчанию доля времени ЦП для обслуживания всех контейнеров одинакова. Чтобы изменить относительную долю времени ЦП для обслуживания контейнеров, примените флаг --cpu-shares со значением от 1 до 10 000. По умолчанию вес всех контейнеров равен 5000. Дополнительные сведения об ограничении распределения ресурсов ЦП см. в [справке по Docker Run](https://docs.docker.com/engine/reference/run/#cpu-share-constraint).

```powershell 
C:\> docker run -it --cpu-shares 2 --name dockerdemo windowsservercore cmd
```

## Известные проблемы

- Контейнеры Hyper-V в настоящее время не поддерживают элементы управления ресурсами ЦП и ввода-вывода.
- В настоящие время невозможно использовать элементы управления ресурсами ЦП и ввода-вывода для общих папок контейнеров.

## Видеоруководство

<iframe src="https://channel9.msdn.com/Blogs/containers/Container-Fundamentals--Part-4-Resource-Management/player#ccLang=ru" width="800" height="450"  allowFullScreen="true" frameBorder="0" scrolling="no"></iframe>







<!--HONumber=Feb16_HO4-->


