---
title: "Контейнеры Windows — проблемы и их решение"
description: "Контейнеры Windows — проблемы и их решение"
keywords: docker, containers
author: scooley
manager: timlt
ms.date: 05/26/2016
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 5d9f1cb4-ffb3-433d-8096-b085113a9d7b
redirect_url: ../containers_welcome
ms.sourcegitcommit: e3f5535594123f6b4f8931e41a91d92f3b837814
ms.openlocfilehash: 085bb8c0158aedf4270cf2423114ec1901af1ebd

---

# Проблемы и их решение

Если на этой странице нет решения вашей проблемы или у вас есть вопросы, задайте их на [форуме](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

-----------------------

## Основные функции

### Соответствие номера сборки контейнера и узла
Контейнеру Windows требуется образ операционной системы, сборка и уровень обновления которого соответствуют узлу контейнера. Несоответствие может привести к нестабильной работе и непредсказуемому поведению контейнера и/или узла.

При установке обновлений для ОС узла контейнера Windows будет необходимо обновить базовый образ ОС контейнера, чтобы обеспечить соответствие их обновлений.
<!-- Can we give examples of behavior or errors?  Makes it more searchable -->

**Решение проблемы**   
Загрузите и установите базовый образ контейнера, соответствующий версии ОС и уровню обновления узла контейнера.

### Поведение брандмауэра по умолчанию
В узле контейнера и среде контейнеров доступен только брандмауэр узла контейнера. Все правила брандмауэра, настроенные в узле контейнера, распространяются на все его контейнеры.

### Контейнеры Windows запускаться медленно
Если контейнер запускается более 30 секунд, возможно, он выполняет несколько повторяющихся проверок на наличие вирусов.

Многие решения для защиты от вредоносных программ, например Защитник Windows, могут выполнять ненужные проверки файлов в образах контейнеров, в том числе всех двоичных файлов операционной системы и файлов в образе ОС контейнера.  Это происходит каждый раз при создании нового контейнера. С точки зрения средств для защиты от вредоносных программ все файлы контейнера выглядят как новые файлы, которые ранее не проверялись.  Поэтому при попытке чтения этих файлов процессами внутри контейнера компоненты защиты от вредоносных программ сначала проверяют их перед предоставлением доступа к файлам.  На самом деле эти файлы уже проверялись во время импорта образа контейнера или его помещения на сервер. Начиная с версии Windows Server Technical Preview 5, внедряется новая инфраструктура, в которой решения для защиты от вредоносных программ, включая Защитник Windows, будут предусматривать такие ситуации и смогут действовать соответствующим образом, чтобы избежать лишних проверок. Решения для защиты от вредоносных программ можно обновить, используя описанные [здесь](https://msdn.microsoft.com/en-us/windows/hardware/drivers/ifs/anti-virus-optimization-for-windows-containers) рекомендации, чтобы избежать многократных проверок. 

### Иногда не удается выполнить запуск и остановку, если память ограничена объемом менее 48 МБ.
В контейнерах Windows могут случайным образом возникать несогласованные ошибки, если память ограничена объемом менее 48 МБ.

Выполнение указанной ниже команды PowerShell и многократное повторение действий запуска и остановки приведет к ошибкам при запуске или остановке.

```PowerShell
new-container "Test" -containerimagename "WindowsServerCore" -MaximumBytes 32MB
start-container test
stop-container test
```

**Решение проблемы**  
Измените значение памяти на 48 МБ. 


### Сбой запуска контейнера происходит, если на виртуальной машине с 4 ядрами число процессоров имеет значение 1 или 2

Контейнеры Windows не удается запустить. Возникает следующая ошибка:  
`failed to start: This operation returned because the timeout period expired. (0x800705B4).`

Эта ошибка возникает, когда число процессоров на виртуальной машине с 4 ядрами имеет значение 1 или 2.

``` PowerShell
new-container "Test2" -containerimagename "WindowsServerCore"
Set-ContainerProcessor -ContainerName test2 -Maximum 2
Start-Container test2

Start-Container : 'test2' failed to start.
'test2' failed to start: This operation returned because the timeout period expired. (0x800705B4).
'test2' failed to start. (Container ID 133E9DBB-CA23-4473-B49C-441C60ADCE44)
'test2' failed to start: This operation returned because the timeout period expired. (0x800705B4). (Container ID
133E9DBB-CA23-4473-B49C-441C60ADCE44)
At line:1 char:1
+ Start-Container test2
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationTimeout: (:) [Start-Container], VirtualizationException
    + FullyQualifiedErrorId : OperationTimeout,Microsoft.Containers.PowerShell.Cmdlets.StartContainer
PS C:\> Set-ContainerProcessor -ContainerName test2 -Maximum 3
PS C:\> Start-Container test2
```

**Решение проблемы**  
Увеличьте число процессоров, доступных для контейнера, не указывайте явно процессоры, доступные для контейнера, или уменьшите число процессоров, доступных для виртуальной машины.

--------------------------

## Сеть

### Изоляция секций сети и ее особенности
Каждый контейнер использует секцию сети для обеспечения изоляции. Все сетевые адаптеры контейнера (конечные точки), подключенные к заданному контейнеру, будут находиться в одной секции сети. В зависимости от используемого сетевого режима (драйвера) доступ к двум разным конечным точкам контейнера с помощью одного IP-адреса или порта может быть невозможен. Кроме того, правила брандмауэра Windows не учитывают секции или контейнеры, поэтому любые подключенные правила применяются для всех контейнеров на узле контейнера, независимо от конкретной конечной точки.

*** Прозрачное сетевое взаимодействие ***


*** Сетевое взаимодействие NAT *** Можно предоставить несколько конечных точек, подключенных к одному контейнеру, с помощью правил перенаправления портов NAT, которые применяются отдельно для каждой конечной точки. Этих правила перенаправления должны использовать разные внешние порты (на узле контейнера) при сопоставлении с одним внутренним портом (в контейнере).  Однако, как было указано выше, подключенные правила брандмауэра действуют в глобальном масштабе для всего узла контейнера.



### Статическое сопоставление NAT может конфликтовать с сопоставлением портов через Docker
Начиная с Windows Server Technical Preview 5, правила создания NAT и сопоставления портов интегрированы в командлеты *ContainerNetwork* и команды Docker. Сетевая служба узлов Windows (HNS) будет управлять NAT от вашего имени. Тем не менее, внешний клиент может попробовать создать дублирующееся правило сопоставления портов с помощью NAT, созданного службой HNS.


Вот пример конфликта со статическим сопоставлением для порта  80 и соответствующей ошибки, выдаваемой Docker.
```
C:\Users\Administrator>docker run -it -p 80:80 windowsservercore cmd
docker: Error response from daemon: failed to create endpoint berserk_bassi on network nat: hnsCall failed in Win32: The remote procedure call failed. (0x6be).
```


***Устранение*** Такая ситуация является крайне маловероятной, так как служба HNS управляет NAT. Все правила перенаправления и сопоставления портов следует создавать с помощью `docker run -p <external>:<internal>` или Add-ContainerNetworkAdapterStaticMapping. Однако, если служба HNS не удаляет сопоставления автоматически, эту ошибку можно устранить, удалив сопоставление портов с помощью PowerShell. Это приведет к удалению конфликта порта 80 в приведенном выше примере.
```powershell
Get-NetNatStaticMapping | ? ExternalPort -eq 80 | Remove-NetNatStaticMapping
```


### Контейнеры Windows не получают IP-адреса
При подключении к контейнерам Windows с коммутаторами виртуальной машины DHCP возможна ситуация, когда узел контейнера получает IP-адрес, а контейнеры — нет.

Контейнеры получают адрес 169.254.***.*** IP-адрес системы автоматического назначения частных IP-адресов.

**Решение проблемы.** Это побочный эффект совместного использования ядра.  В результате все контейнеры имеют одинаковый MAC-адрес.

Включите спуфинг MAC-адресов на физическом узле, где размещается виртуальная машина узла контейнера.

Это можно сделать с помощью PowerShell
```
Get-VMNetworkAdapter -VMName "[YourVMNameHere]"  | Set-VMNetworkAdapter -MacAddressSpoofing On
```
--------------------------

## Совместимость приложений

В связи с большим числом вопросов о том, какие приложения могут работать в контейнерах Windows, мы решили выделить сведения о совместимости приложений в [отдельную статью](../reference/app_compat.md).

В этой статье также описаны некоторые из наиболее распространенных проблем.

### Журналы событий недоступны внутри контейнера.

Команды PowerShell, такие как `get-eventlog Application` и API, отправляющие запросы в журнал событий, возвратят ошибку, похожую на приведенную ниже:
```
get-eventlog : Cannot open log Application on machine .. Windows has not provided an error code.
At line:1 char:1
```

В качестве решения можно добавить этот шаг в файл Dockerfile. Для образов, создаваемых на этом этапе, включено ведение журнала событий.
```
RUN powershell.exe -command Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\WMI\Autologger\EventLog-Application Start 1
```


### При вызове метода API экземпляра LocalDB произошла непредвиденная ошибка
При вызове метода API экземпляра LocalDB произошла непредвиденная ошибка

### RTerm не работает
RTerm устанавливается, но не запускается в контейнере Windows Server.

Ошибка:  
```
'C:\Program' is not recognized as an internal or external command,
operable program or batch file.
```


### Контейнер: среда выполнения Visual C++ x64/x86 2015 не устанавливается

Наблюдаемое поведение — в контейнере:
```
C:\build\vcredist_2015_x64.exe /q /norestart
C:\build>echo %errorlevel%
0
C:\build>wmic product get
No Instance(s) Available.
```

Это проблема взаимодействия с фильтром дедупликации. Дедупликация проверяет, является ли файл, предназначенный для переименования, дедуплицированным файлом. Возникает сбой операции создания с ошибкой `STATUS_IO_REPARSE_TAG_NOT_HANDLED`, так как фильтр контейнера Windows Server находится выше дедупликации.


Дополнительные сведения о приложениях, которые можно помещать в контейнеры, см. в [статье о совместимости приложений](../reference/app_compat.md).

--------------------------


## Управление Docker

### Не все команды Docker работают
* Исполняемый файл Docker работает со сбоями в контейнерах Hyper-V.

В случае сбоя команды, которой нет в этом списке (или непредусмотренного сбоя команды из списка), сообщите нам об этом на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

### В интерактивный сеанс Docker можно вставлять команды длиной не более 50 символов
В интерактивный сеанс Docker можно вставлять команды длиной не более 50 символов.  
В настоящее время при копировании командной строки в интерактивный сеанс Docker ее длина не может превышать 50 символов. Вставленные строки просто усекаются.

Это сделано не намеренно. Мы работаем над устранением этого ограничения.

### Ошибки команды net use
Команда net use возвращает системную ошибку 1223 вместо запроса имени пользователя и пароля

**Решение проблемы**  
Укажите имя пользователя и пароль при запуске команды net use.

``` PowerShell
net use S: \\your\sources\here /User:shareuser [yourpassword]
``` 


--------------------------



## Удаленный рабочий стол 

Управление контейнерами Windows и взаимодействие с ними через сеанс RDP в TP5 недоступны.

--------------------------

### Выход контейнера из узла контейнера Nano Server не может быть выполнен с помощью команды exit
Попытка выхода контейнера, который находится на узле контейнера Nano Server, с помощью команды exit приведет к отключению от узла контейнера Nano Server, при этом контейнер из узла не выйдет.

**Решение проблемы.** Вместо этого для выхода контейнера используйте команду Exit-PSSession.

Новые функции можно запросить на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers). 


--------------------------


## Пользователи и домены

### Локальные пользователи
Локальные учетные записи пользователей можно создать и использовать для запуска служб и приложений Windows в контейнерах.


### Членство в домене
Контейнеры не могут присоединиться к доменам Active Directory и запускать службы или приложения в роли пользователей домена, учетных записей службы или компьютера. 

Контейнеры предназначены для быстрого запуска и перехода в известное согласованное состояние, которое по большей части не зависит от среды запуска. При присоединении к домену и применении параметров групповой политики из домена увеличило бы необходимое для запуска контейнера время, постепенно изменило бы его функционирование и ограничило бы возможность перемещения или совместного использования образов разработчиками и в развертываниях.

Мы внимательно рассматриваем отзывы об использовании Active Directory службами и приложениями, а также пересечении их развертывания в контейнерах. Если у вас есть предложения по улучшению работы, поделитесь этим с нами на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers). 

Мы активно ищем решения для поддержки таких типов сценариев.



<!--HONumber=Jun16_HO4-->


