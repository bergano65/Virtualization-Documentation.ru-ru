



# Проблемы и их решение

Если на этой странице нет решения вашей проблемы или у вас есть вопросы, задайте их на [форуме](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

-----------------------


## Основные функции

### Соответствие номера сборки контейнера и узла

Контейнеру Windows требуется образ операционной системы, сборка и уровень обновления которого соответствуют узлу контейнера. Несоответствие может привести к нестабильной работе и непредсказуемому поведению контейнера и/или узла.

При установке обновлений для ОС узла контейнера Windows будет необходимо обновить базовый образ ОС контейнера, чтобы обеспечить соответствие их обновлений.


**Решение проблемы**   
Загрузите и установите базовый образ контейнера, соответствующий версии ОС и уровню обновления узла контейнера.

### Поведение брандмауэра по умолчанию

В узле контейнера и среде контейнеров доступен только брандмауэр узла контейнера. Все правила брандмауэра, настроенные в узле контейнера, распространяются на все его контейнеры.

### Контейнеры Windows запускаться медленно

Если контейнер запускается более 30 секунд, возможно, он выполняет несколько повторяющихся проверок на наличие вирусов.

Многие решения для защиты от вредоносных программ, например Защитник Windows, могут выполнять ненужные проверки файлов в образах контейнеров, в том числе всех двоичных файлов операционной системы и файлов в образе ОС контейнера. Это происходит каждый раз при создании нового контейнера. С точки зрения средств для защиты от вредоносных программ все файлы контейнера выглядят как новые файлы, которые ранее не проверялись. Поэтому при попытке чтения этих файлов процессами внутри контейнера компоненты защиты от вредоносных программ сначала проверяют их перед предоставлением доступа к файлам. На самом деле эти файлы уже проверялись во время импорта образа контейнера или его помещения на сервер. В будущих предварительных выпусках будет внедрена новая инфраструктура, в которой решения для защиты от вредоносных программ, включая Защитник Windows, будут предусматривать такие ситуации и смогут действовать соответствующим образом, чтобы избежать лишних проверок.

### Иногда не удается выполнить запуск и остановку, если память ограничена объемом менее 48 МБ.

В контейнерах Windows могут случайным образом возникать несогласованные ошибки, если память ограничена объемом менее 48 МБ.

Выполнение указанной ниже команды PowerShell и многократное повторение действий запуска и остановки приведет к ошибкам при запуске или остановке.

```PowerShell
new-container "Test" -containerimagename "WindowsServerCore" -MaximumBytes 32MB
start-container test
stop-container test
```

**Решение проблемы**  
Измените значение памяти на 48 МБ.


### Сбой запуска контейнера происходит, если на виртуальной машине с 4 ядрами число процессоров имеет значение 1 или 2

Контейнеры Windows не удается запустить. Возникает следующая ошибка:  
"Сбой при запуске. Возврат из операции произошел из-за превышения времени ожидания. (0x800705B4)".

Эта ошибка возникает, когда число процессоров на виртуальной машине с 4 ядрами имеет значение 1 или 2.

``` PowerShell
new-container "Test2" -containerimagename "WindowsServerCore"
Set-ContainerProcessor -ContainerName test2 -Maximum 2
Start-Container test2

Start-Container : 'test2' failed to start.
'test2' failed to start: This operation returned because the timeout period expired. (0x800705B4).
'test2' failed to start. (Container ID 133E9DBB-CA23-4473-B49C-441C60ADCE44)
'test2' failed to start: This operation returned because the timeout period expired. (0x800705B4). (Container ID
133E9DBB-CA23-4473-B49C-441C60ADCE44)
At line:1 char:1
+ Start-Container test2
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationTimeout: (:) [Start-Container], VirtualizationException
    + FullyQualifiedErrorId : OperationTimeout,Microsoft.Containers.PowerShell.Cmdlets.StartContainer
PS C:\> Set-ContainerProcessor -ContainerName test2 -Maximum 3
PS C:\> Start-Container test2
```

**Решение проблемы**  
Увеличьте число процессоров, доступных для контейнера, не указывайте явно процессоры, доступные для контейнера, или уменьшите число процессоров, доступных для виртуальной машины.

--------------------------


## Сеть

### Ограниченное количество секций сети

В этом выпуске поддерживается одна секция сети на контейнер. Это означает, что, если контейнер имеет несколько сетевых адаптеров, невозможно получить доступ к одному сетевому порту на каждом адаптере (например, к портам 192.168.0.1:80 и 192.168.0.2:80, принадлежащим одному контейнеру).

**Решение проблемы **  
Если контейнер должен предоставлять несколько конечных точек, используйте сопоставление портов NAT.


### Статическое сопоставление NAT может конфликтовать с сопоставлением портов через Docker

При создании контейнеров с помощью Windows PowerShell и добавлении статических сопоставлений NAT они могут вызвать конфликты, если не удалить их перед запуском контейнера командой `docker -p <источник>:<получатель>`.

Ниже приведен пример конфликта со статическим сопоставлением на порту 80
```
PS C:\IISDemo> Add-NetNatStaticMapping -NatName "ContainerNat" -Protocol TCP -ExternalIPAddress 0.0.0.0 -InternalIPAddress
 172.16.0.2 -InternalPort 80 -ExternalPort 80


StaticMappingID               : 1
NatName                       : ContainerNat
Protocol                      : TCP
RemoteExternalIPAddressPrefix : 0.0.0.0/0
ExternalIPAddress             : 0.0.0.0
ExternalPort                  : 80
InternalIPAddress             : 172.16.0.2
InternalPort                  : 80
InternalRoutingDomainId       : {00000000-0000-0000-0000-000000000000}
Active                        : True



PS C:\IISDemo> docker run -it -p 80:80 microsoft/iis cmd
docker: Error response from daemon: Cannot start container 30b17cbe85539f08282340cc01f2797b42517924a70c8133f9d8db83707a2c66: 
HCSShim::CreateComputeSystem - Win32 API call returned error r1=2147942452 err=You were not connected because a 
duplicate name exists on the network. If joining a domain, go to System in Control Panel to change the computer name
 and try again. If joining a workgroup, choose another workgroup name. 
 id=30b17cbe85539f08282340cc01f2797b42517924a70c8133f9d8db83707a2c66 configuration= {"SystemType":"Container",
 "Name":"30b17cbe85539f08282340cc01f2797b42517924a70c8133f9d8db83707a2c66","Owner":"docker","IsDummy":false,
 "VolumePath":"\\\\?\\Volume{4b239270-c94f-11e5-a4c6-00155d016f0a}","Devices":[{"DeviceType":"Network","Connection":
 {"NetworkName":"Virtual Switch","EnableNat":false,"Nat":{"Name":"ContainerNAT","PortBindings":[{"Protocol":"TCP",
 InternalPort":80,"ExternalPort":80}]}},"Settings":null}],"IgnoreFlushesDuringBoot":true,
 "LayerFolderPath":"C:\\ProgramData\\docker\\windowsfilter\\30b17cbe85539f08282340cc01f2797b42517924a70c8133f9d8db83707a2c66",
 "Layers":[{"ID":"4b91d267-ecbc-53fa-8392-62ac73812c7b","Path":"C:\\ProgramData\\docker\\windowsfilter\\39b8f98ccaf1ed6ae267fa3e98edcfe5e8e0d5414c306f6c6bb1740816e536fb"},
 {"ID":"ff42c322-58f2-5dbe-86a0-8104fcb55c2a",
"Path":"C:\\ProgramData\\docker\\windowsfilter\\6a182c7eba7e87f917f4806f53b2a7827d2ff0c8a22d200706cd279025f830f5"},
{"ID":"84ea5d62-64ed-574d-a0b6-2d19ec831a27",
"Path":"C:\\ProgramData\\Microsoft\\Windows\\Images\\CN=Microsoft_WindowsServerCore_10.0.10586.0"}],
"HostName":"30b17cbe8553","MappedDirectories":[],"SandboxPath":"","HvPartition":false}.
```


***Решение проблемы***
Решить эту проблему можно, удалив сопоставление портов с помощью PowerShell. Это приведет к удалению конфликта порта 80 в приведенном выше примере.
```powershell
Get-NetNatStaticMapping | ? ExternalPort -eq 80 | Remove-NetNatStaticMapping
```


### Контейнеры Windows не получают IP-адреса

При подключении к контейнерам Windows с коммутаторами виртуальной машины DHCP возможна ситуация, когда узел контейнера получает IP-адрес, а контейнеры — нет.

Контейнеры получают IP-адрес APIPA 169.254.***.***

**Решение проблемы**
Это побочный эффект совместного использования ядра. В результате все контейнеры имеют одинаковый MAC-адрес.

Включите спуфинг MAC-адресов на узле контейнера.

Это можно сделать с помощью PowerShell
```
Get-VMNetworkAdapter -VMName "[YourVMNameHere]"  | Set-VMNetworkAdapter -MacAddressSpoofing On
```
### HTTPS и TLS не поддерживаются

Контейнеры Windows Server и Hyper-V не поддерживают протокол HTTPS или TLS. Мы работаем над тем, чтобы это стало доступно в будущем.

--------------------------


## Совместимость приложений

В связи с большим числом вопросов о том, какие приложения могут работать в контейнерах Windows, мы решили выделить сведения о совместимости приложений в [отдельную статью](../reference/app_compat.md).

В этой статье также описаны некоторые из наиболее распространенных проблем.

### При вызове метода API экземпляра LocalDB произошла непредвиденная ошибка

При вызове метода API экземпляра LocalDB произошла непредвиденная ошибка

### RTerm не работает

RTerm устанавливается, но не запускается в контейнере Windows Server.

Ошибка:
```
'C:\Program' is not recognized as an internal or external command,
operable program or batch file.
```


### Контейнер: среда выполнения Visual C++ x64/x86 2015 не устанавливается

Наблюдаемое поведение
в контейнере:
```
C:\build\vcredist_2015_x64.exe /q /norestart
C:\build>echo %errorlevel%
0
C:\build>wmic product get
No Instance(s) Available.
```

Это проблема взаимодействия с фильтром дедупликации. Дедупликация проверяет, является ли файл, предназначенный для переименования, дедуплицированным файлом. Возникает сбой операции создания с ошибкой `STATUS_IO_REPARSE_TAG_NOT_HANDLED`, так как фильтр контейнера Windows Server находится выше дедупликации.


Дополнительные сведения о приложениях, которые можно помещать в контейнеры, см. в [статье о совместимости приложений](../reference/app_compat.md).

--------------------------



## Управление Docker

### Клиенты Docker не защищены

В этом предварительном выпуске соединение Docker открыто, если знать, где искать.

### Не все команды Docker работают

* Исполняемый файл Docker работает со сбоями в контейнерах Hyper-V.
* Команды, связанные с DockerHub, пока не поддерживаются.

В случае сбоя команды, которой нет в этом списке (или непредусмотренного сбоя команды из списка), сообщите нам об этом на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

### В интерактивный сеанс Docker можно вставлять команды длиной не более 50 символов

В интерактивный сеанс Docker можно вставлять команды длиной не более 50 символов.  
В настоящее время при копировании командной строки в интерактивный сеанс Docker ее длина не может превышать 50 символов. Вставленные строки просто усекаются.

Это сделано не намеренно. Мы работаем над устранением этого ограничения.

### Ошибки команды net use

Команда net use возвращает системную ошибку 1223 вместо запроса имени пользователя и пароля

**Решение проблемы**  
Укажите имя пользователя и пароль при запуске команды net use.

``` PowerShell
net use S: \\your\sources\here /User:shareuser [yourpassword]
```


--------------------------




## Удаленный рабочий стол

Управление контейнерами Windows и взаимодействие с ними через сеанс RDP в TP4 недоступны.

--------------------------


## Управление PowerShell

### Не все командлеты *-PSSession имеют аргумент containerid

Это правда. Мы планируем реализовать полную поддержку CimSession в будущем.

### Выход контейнера из узла контейнера Nano Server не может быть выполнен с помощью команды exit

Попытка выхода контейнера, который находится на узле контейнера Nano Server, с помощью команды exit приведет к отключению от узла контейнера Nano Server, при этом контейнер из узла не выйдет.

**Решение проблемы**
Вместо этого для выхода контейнера используйте команду Exit-PSSession.

Новые функции можно запросить на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).


--------------------------



## Пользователи и домены

### Локальные пользователи

Локальные учетные записи пользователей можно создать и использовать для запуска служб и приложений Windows в контейнерах.


### Членство в домене

Контейнеры не могут присоединиться к доменам Active Directory и запускать службы или приложения в роли пользователей домена, учетных записей службы или компьютера.

Контейнеры предназначены для быстрого запуска и перехода в известное согласованное состояние, которое по большей части не зависит от среды запуска. При присоединении к домену и применении параметров групповой политики из домена увеличило бы необходимое для запуска контейнера время, постепенно изменило бы его функционирование и ограничило бы возможность перемещения или совместного использования образов разработчиками и в развертываниях.

Мы внимательно рассматриваем отзывы об использовании Active Directory службами и приложениями, а также пересечении их развертывания в контейнерах. Если у вас есть предложения по улучшению работы, поделитесь этим с нами на [форумах](https://social.msdn.microsoft.com/Forums/en-US/home?forum=windowscontainers).

Мы активно ищем решения для поддержки таких типов сценариев.






<!--HONumber=Feb16_HO4-->


