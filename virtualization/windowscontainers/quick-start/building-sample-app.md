---
title: Контаинеризе приложения .NET Core
description: Знакомство с созданием примера основного приложения .NET с контейнерами
keywords: docker, контейнеры
author: cwilhit
ms.date: 09/10/2019
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.openlocfilehash: cf8a14002e962242c34e9a10086120e6942d382b
ms.sourcegitcommit: 6080b2c5053720490d374f6fb0daa870d5ddd4e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2019
ms.locfileid: "10257778"
---
# <a name="containerize-a-net-core-app"></a>Контаинеризе приложения .NET Core

Этот сегмент предполагает, что ваша среда разработки уже настроена на использование контейнеров. Если у вас нет среды, настроенной для контейнеров, перейдите по фразе "[Настройка среды](./set-up-environment.md)", чтобы узнать, как начать работу.

На вашем компьютере должна быть установлена система управления версиями Git. Вы можете взять его сюда: [Git](https://git-scm.com/download)

## <a name="clone-the-sample-code"></a>Копирование примера кода

Весь образец исходного кода контейнера хранится в разделе " [виртуализация — документация](https://github.com/MicrosoftDocs/Virtualization-Documentation) Git" в папке с `windows-container-samples`именем "". Клонировать этот репозиторий Git в рабочий каталог курент.

```Powershell
git clone https://github.com/MicrosoftDocs/Virtualization-Documentation.git
```

Перейдите к каталогу примеров, найденному в разделе `Virtualization-Documentation\windows-container-samples\asp-net-getting-started` , и создайте доккерфиле. [Доккерфиле](https://docs.docker.com/engine/reference/builder/) — это файл Makefile — список инструкций, которые указывают обработчику контейнеров, как должно быть построено изображение контейнера.

```Powershell
# navigate into the sample directory
Set-Location -Path Virtualization-Documentation\windows-container-samples\asp-net-getting-started

# create the Dockerfile for our project
New-Item -Name Dockerfile -ItemType file
```

## <a name="write-the-dockerfile"></a>Написание доккерфиле

Откройте доккерфиле, который вы только что создали (в любом текстовом редакторе), и добавьте в него следующее содержимое.

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:2.1 AS build-env
WORKDIR /app

COPY *.csproj ./
RUN dotnet restore

COPY . ./
RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/core/aspnet:2.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "asp-net-getting-started.dll"]
```

Разбейте ее на строчные и объясните, что это за все инструкции.

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:2.1 AS build-env
WORKDIR /app
```

В первой группе строк объявляется базовый образ, который будет использоваться для создания контейнера. Если в локальной системе еще нет этого образа, Docker автоматически попробует извлечь его. `mcr.microsoft.com/dotnet/core/sdk:2.1` Она поставляется вместе с установленным пакетом SDK .net Core 2,1, поэтому она занимается созданием основных проектов ASP .NET, нацеленных на версию 2,1. Следующая инструкция изменяет рабочий каталог в нашем контейнере так `/app`, чтобы все команды, следующие за этим, выполнялись в данном контексте.

```Dockerfile
COPY *.csproj ./
RUN dotnet restore
```

Затем эти инструкции копируют файлы с. csproj в `build-env` `/app` каталог контейнера. После копирования этого файла .NET начнет чтение из него, а затем выбираю все зависимости и инструменты, необходимые для нашего проекта.

```Dockerfile
COPY . ./
RUN dotnet publish -c Release -o out
```

После того как .NET запрашивает все зависимости в `build-env` контейнере, следующая инструкция копирует все исходные файлы проекта в контейнер. Затем мы указываем .NET, чтобы опубликовать наше приложение в конфигурации выпуска и указать путь вывода в.

Компиляция должна выполняться успешно. Теперь необходимо создать финальное изображение. 

> [!TIP]
> В этом кратком руководстве производится сборка основного проекта .NET из исходного кода. При построении изображений контейнера рекомендуется включать в изображение контейнера _только_ полезные данные производства и зависимые от него зависимости. Мы не будем нуждаться в использовании пакета .NET Core SDK, включенного в наш конечный образ, так как нам нужна только среда выполнения .NET Core, поэтому доккерфиле использует временный контейнер, упакованный вместе `build-env` с пакетом SDK, для которого требуется построить приложение.

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/aspnet:2.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "asp-net-getting-started.dll"]
```

Так как наше приложение — ASP.NET, мы указываем изображение, которое включает в себя эту среду выполнения. Затем мы скопируем все файлы из выходного каталога временного контейнера в финальный контейнер. Мы настроили наш контейнер для работы с нашим новым приложением в качестве точки входа при запуске контейнера

Мы написали доккерфиле для выполнения сборки с _несколькими этапами_. После выполнения доккерфиле будет использовать временный контейнер `build-env`, используя пакет SDK .net Core 2,1 для сборки примера приложения, а затем скопировать введенные двоичные файлы в другой контейнер, содержащий только среду выполнения .net Core 2,1, чтобы мы максимально минимизировать размер конечный контейнер.

## <a name="run-the-app"></a>Запуск приложения

Доккерфиле написал, что мы можем указать Dock на нашем доккерфиле и рассказать ему о том, как создать наше изображение. 

>[!IMPORTANT]
>Выполняемые ниже команды должны выполняться в каталоге, где находится доккерфиле.

```Powershell
docker build -t my-asp-app .
```

Чтобы запустить контейнер, выполните команду, приведенную ниже.

```Powershell
docker run -d -p 5000:80 --name myapp my-asp-app
```

Давайте диссект эту команду:

* `-d` Указывает на то, что Dock Тун запускает контейнер "отсоединен", то есть консоль не подключена к консоли внутри контейнера. Контейнер выполняется в фоновом режиме. 
* `-p 5000:80` Указывает Dock для сопоставления порта 5000 на узле с портом 80 в контейнере. Каждый контейнер получает собственный IP-адрес. ASP .NET по умолчанию прослушивает порт 80. Сопоставление портов позволяет нам перейти с IP-адреса узла на сопоставленный порт, и стыковочный объект будет пересылать весь трафик на порт назначения в контейнере.
* `--name myapp` Указывает Dock для предоставления этому контейнеру удобного имени для запроса (вместо поиска идентификатора контаиенр, назначенного во время выполнения Dock.)
* `my-asp-app` — Это изображение, которое будет использоваться для запуска Dock. Это изображение контейнера, созданное как кулминатион `docker build` процесса.

Откройте веб-браузер веб-браузера и перейдите `https://localhost:5000` в раздел для гритед с помощью контейнера приложения.

>![](media/SampleAppScreenshot.png)

## <a name="next-steps"></a>Дальнейшие действия

Мы успешно подASP.NET веб-приложение "приложения". Чтобы просмотреть другие примеры приложений и связанные с ними доккерфилес, нажмите кнопку ниже.

> [!div class="nextstepaction"]
> [Дополнительные примеры контейнеров](../samples.md)
