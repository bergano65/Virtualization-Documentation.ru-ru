---
title: "Создание примера приложения"
description: "Узнайте, как создать пример приложения с помощью контейнеров"
keywords: "docker, контейнеры"
author: cwilhit
ms.date: 07/25/2017
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.openlocfilehash: b9f20e6b3f071b9c71a387fce9640b244e9a95b5
ms.sourcegitcommit: fa9ec91b14c612df03c5b7bb094eb1fabf421715
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="build-a-sample-app"></a>Создание примера приложения

В этом упражнении показано, как преобразовать пример приложения ASP.net для запуска в контейнере. Если вы хотите узнать, как использовать контейнеры в Windows 10, изучите раздел [Краткое руководство для Windows 10](./quick-start-windows-10.md).

Это краткое руководство применимо только к Windows 10. Дополнительную документацию по быстрому началу работы можно найти в содержании в левой части этой страницы. Так как этот учебник посвящен контейнерам, мы будем писать код только с помощью контейнеров. Если вам нужен учебник для разработки с нуля, его можно найти в [документации по ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-mvc-app-xplat/).

Если у вас на компьютере не установлен элемент управления версиями Git, его можно скачать здесь: [Git](https://git-scm.com/download).

## <a name="getting-started"></a>начало работы

Этот пример проекта был создан с помощью [VSCode](https://code.visualstudio.com/). Мы также используем Powershell. Скачаем код демонстрации из github. Вы можете клонировать репозиторий с помощью git или скачать проект непосредственно из [SampleASPContainerApp](https://github.com/cwilhit/SampleASPContainerApp).

```Powershell
git clone https://github.com/cwilhit/SampleASPContainerApp.git
```

Перейдем в каталог проекта и создадим файл Dockerfile. Файл [Dockerfile](https://docs.docker.com/engine/reference/builder/) похож на makefile— это список инструкций, описывающих, как создать образ контейнера.

```Powershell
#Create the dockerfile for our proj
New-Item C:/Your/Proj/Location/Dockerfile -type file
```

## <a name="writing-our-dockerfile"></a>Создание файла Dockerfile

Теперь откроем этот файл Dockerfile, созданный в корневой папке проекта, в любом текстовом редакторе и добавим в него логику. Затем мы построчно рассмотрим его и объясним, что происходит.

```Dockerfile
FROM microsoft/aspnetcore-build:1.1 AS build-env
WORKDIR /app

COPY *.csproj ./
RUN dotnet restore

COPY . ./
RUN dotnet publish -c Release -o out

FROM microsoft/aspnetcore:1.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "MvcMovie.dll"]
```

В первой группе строк объявляется базовый образ, который будет использоваться для создания контейнера. Если в локальной системе еще нет этого образа, Docker автоматически попробует извлечь его. Aspnetcore-build поставляется вместе с зависимыми компонентами для компиляции проекта. Затем мы изменим рабочий каталог в контейнере на "/app", чтобы все команды в dockerfile исполнялись в нем.

_Примечание_. Нам необходимо собрать наш проект, поэтому сначала мы создадим временный контейнер, который мы удалим впоследствии.

```Dockerfile
FROM microsoft/aspnetcore-build:1.1 AS build-env
WORKDIR /app
```

Затем мы скопируем CSPROJ-файлы в каталог "/app" временного контейнера. Это необходимо, так как CSPROJ-файлы содержат файлы содержат список ссылок пакета, необходимых для проекта.

После копирования этого файла платформа dotnet считает из него данные и извлечет все зависимые компоненты и средства для нашего проекта.

```Dockerfile
COPY *.csproj ./
RUN dotnet restore
```

После этого мы скопируем их во временный контейнер. Затем мы сообщим dotnet о необходимости публикации приложения с конфигурацией выпуска и укажем путь вывода.

```Dockerfile
COPY . ./
RUN dotnet publish -c Release -o out
```

Компиляция проекта должна завершиться успешно. Теперь нам нужно создать окончательную версию контейнера. Так как наше приложение основано на ASP.NET, мы указываем образ, используя эти библиотеки в качестве источника. Затем мы скопируем все файлы из выходного каталога временного контейнера в финальный контейнер. Мы настраиваем контейнер для запуска с использованием нового DLL-файла, который компилируется при запуске.

_Примечание_. Наш базовый образ для этого контейнера аналогичен команде ```FROM``` выше, но отличается— в нем нет библиотек для _построения_ приложения ASP.NET, а только для запуска.

```Dockerfile
FROM microsoft/aspnetcore:1.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "MvcMovie.dll"]
```

Мы успешно выполнили _многоэтапную сборку_. Мы использовали временный контейнер для сборки образа и затем переместили опубликованный DLL-файл в другой контейнер, чтобы свести к минимуму конечный результат. Мы хотим, чтобы число зависимых компонентов, необходимых для запуска этого контейнера, было минимальным. Если бы мы продолжили использовать наш первый образ, в него были бы добавлены другие уровни (для создания приложений ASP.NET), которые не были важны, что привело бы к увеличению образа.

## <a name="running-the-app"></a>Запуск приложения

После создания файла dockerfile, осталось только сообщить Docker о сборке приложения и запуске контейнера. Мы указываем порт для публикации и присваиваем контейнеру тег "myapp". Мы выполним следующие команды в PowerShell:

```Powershell
docker build -t myasp .
docker run -d -p 5000:80 --name myapp myasp
```

Чтобы посмотреть на работу приложения, необходимо перейти по адресу, по которому оно запущено. Получим IP-адрес, выполнив следующую команду.

```Powershell
 docker inspect -f "{{ .NetworkSettings.Networks.nat.IPAddress }}" myasp
```

Так мы получим IP-адрес запущенного контейнера. Вот пример того, как могут выглядеть выходные данные команды:

```Powershell
 172.19.172.12
```

Введите этот IP-адрес в браузере по вашему выбору, и вы увидите успешно запущенное в контейнере приложение!

<center style="margin: 25px">![](media/SampleAppScreenshot.png)</center>

Щелкните "MvcMovie" на панели навигации, чтобы перейти на веб-страницу, где можно вводить, изменять и удалять записи о фильмах.

## <a name="next-steps"></a>Дальнейшие действия

Мы успешно преобразовали веб-приложение ASP.NET с помощью Docker и развернули его в работающем контейнере. Но есть и другие действия, которые можно выполнить! Может разбить веб-приложение на дополнительные компоненты— контейнера для запуска веб-API, контейнер, запущенный в интерфейсной части и контейнер с SQL Server.

Теперь, когда вы изучили основы работы с контейнерами, вы можете приступить к разработке прекрасных решений с их помощью. Ниже приведен список других примеров контейнеров.

[Примеры контейнеров](../samples.md)
