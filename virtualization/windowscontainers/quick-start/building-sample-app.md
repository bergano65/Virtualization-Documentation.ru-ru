---
title: Контаинеризе приложения .NET Core
description: Знакомство с созданием примера основного приложения .NET с контейнерами
keywords: docker, контейнеры
author: cwilhit
ms.author: crwilhit
ms.date: 11/12/2019
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.openlocfilehash: fab0dc46ddcc8c82a010d408032e5f3c4cea8d69
ms.sourcegitcommit: e61db4d98d9476a622e6cc8877650d9e7a6b4dd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "10288072"
---
# <a name="containerize-a-net-core-app"></a>Контаинеризе приложения .NET Core

В этой статье объясняется, как упаковать существующий пример приложения .NET для развертывания в качестве контейнера Windows после настройки среды, как описано в разделе Начало [работы: Windows для контейнеров](set-up-environment.md), и запуск вашего первого контейнера, как описано в разделе [выполнение первого контейнера Windows](run-your-first-container.md).

Вам также понадобится система управления версиями Git, установленная на компьютере. Чтобы установить его, посетите [Git](https://git-scm.com/download).

## <a name="clone-the-sample-code-from-github"></a>Копирование примера кода из GitHub

Весь исходный код примера в контейнере хранится в разделе " [виртуализация — документация](https://github.com/MicrosoftDocs/Virtualization-Documentation) Git (известный как репозиторий) в папке с именем `windows-container-samples`" ".

1. Откройте сеанс PowerShell и перейдите в папку, в которой вы хотите сохранить этот репозиторий. (Другие типы окон командной строки также работают, но в приведенных примерах команд используется PowerShell.)
2. Клонировать репозиторий в текущий рабочий каталог:

   ```PowerShell
   git clone https://github.com/MicrosoftDocs/Virtualization-Documentation.git
   ```

3. Перейдите к каталогу примеров, найденному в разделе `Virtualization-Documentation\windows-container-samples\asp-net-getting-started` , и создайте доккерфиле с помощью следующих команд.

   [Доккерфиле](https://docs.docker.com/engine/reference/builder/) — это файл Makefile — этот список содержит инструкции, которые указывают механизму контейнеров, как создать изображение контейнера.

   ```Powershell
   # Navigate into the sample directory
   Set-Location -Path Virtualization-Documentation\windows-container-samples\asp-net-getting-started

   # Create the Dockerfile for our project
   New-Item -Name Dockerfile -ItemType file
   ```

## <a name="write-the-dockerfile"></a>Написание Доккерфиле

Откройте Доккерфиле, который вы только что создали в любом текстовом редакторе, и добавьте следующее содержимое:

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:2.1 AS build-env
WORKDIR /app

COPY *.csproj ./
RUN dotnet restore

COPY . ./
RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/core/aspnet:2.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "asp-net-getting-started.dll"]
```

Разбейте ее на строчные и объясните, что это за все инструкции.

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:2.1 AS build-env
WORKDIR /app
```

В первой группе строк объявляется базовый образ, который будет использоваться для создания контейнера. Если в локальной системе еще нет этого образа, Docker автоматически попробует извлечь его. `mcr.microsoft.com/dotnet/core/sdk:2.1` Она поставляется вместе с установленным пакетом SDK .net Core 2,1, поэтому она занимается созданием основных проектов ASP .NET, нацеленных на версию 2,1. Следующая инструкция изменяет рабочий каталог в нашем контейнере так `/app`, чтобы все команды, следующие за этим, выполнялись в данном контексте.

```Dockerfile
COPY *.csproj ./
RUN dotnet restore
```

Затем эти инструкции копируют файлы с. csproj в `build-env` `/app` каталог контейнера. После копирования этого файла .NET начнет чтение из него, а затем выбираю все зависимости и инструменты, необходимые для нашего проекта.

```Dockerfile
COPY . ./
RUN dotnet publish -c Release -o out
```

После того как .NET запрашивает все зависимости в `build-env` контейнере, следующая инструкция копирует все исходные файлы проекта в контейнер. Затем мы указываем .NET, чтобы опубликовать наше приложение в конфигурации выпуска и указать путь вывода в.

Компиляция должна выполняться успешно. Теперь необходимо создать финальное изображение. 

> [!TIP]
> В этом кратком руководстве производится сборка основного проекта .NET из исходного кода. При построении изображений контейнера рекомендуется включать в изображение контейнера _только_ полезные данные производства и зависимые от него зависимости. Мы не будем нуждаться в использовании пакета .NET Core SDK, включенного в наш конечный образ, так как нам нужна только среда выполнения .NET Core, поэтому доккерфиле использует временный контейнер, упакованный вместе `build-env` с пакетом SDK, для которого требуется построить приложение.

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/aspnet:2.1
WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "asp-net-getting-started.dll"]
```

Так как наше приложение — ASP.NET, мы указываем изображение, которое включает в себя эту среду выполнения. Затем мы скопируем все файлы из выходного каталога временного контейнера в финальный контейнер. Мы настроили наш контейнер для работы с нашим новым приложением в качестве точки входа при запуске контейнера

Мы написали доккерфиле для выполнения сборки с _несколькими этапами_. При выполнении доккерфиле он будет использовать временный контейнер `build-env`, используя пакет SDK .net Core 2,1 для сборки примера приложения, а затем скопировать введенные двоичные файлы в другой контейнер, содержащий только среду выполнения .net Core 2,1, чтобы мы максимально минимизировать размер последнего контейнера.

## <a name="build-and-run-the-app"></a>Сборка и запуск приложения

Доккерфиле написал, что мы можем указать Dock на нашем Доккерфиле и сказать, что он должен создать и затем запустить наше изображение:

1. В окне командной строки перейдите в каталог, в котором находится доккерфиле, и запустите команду [Dock Build](https://docs.docker.com/engine/reference/commandline/build/) , чтобы создать контейнер из доккерфиле.

   ```Powershell
   docker build -t my-asp-app .
   ```

2. Чтобы запустить вновь построенный контейнер, запустите команду [Dock Run](https://docs.docker.com/engine/reference/commandline/run/) .

   ```Powershell
   docker run -d -p 5000:80 --name myapp my-asp-app
   ```

   Давайте диссект эту команду:

   * `-d` Указывает на то, что Dock Тун запускает контейнер "отсоединен", то есть консоль не подключена к консоли внутри контейнера. Контейнер выполняется в фоновом режиме. 
   * `-p 5000:80` Указывает Dock для сопоставления порта 5000 на узле с портом 80 в контейнере. Каждый контейнер получает собственный IP-адрес. ASP .NET по умолчанию прослушивает порт 80. Сопоставление портов позволяет нам перейти с IP-адреса узла на сопоставленный порт, и стыковочный объект будет пересылать весь трафик на порт назначения в контейнере.
   * `--name myapp` Указывает Dock для предоставления этому контейнеру удобного имени для запроса (вместо поиска идентификатора контаиенр, назначенного во время выполнения Dock.)
   * `my-asp-app` — Это изображение, которое будет использоваться для запуска Dock. Это изображение контейнера, созданное как кулминатион `docker build` процесса.

3. Откройте веб-браузер веб-браузера и перейдите `http://localhost:5000` в раздел для просмотра вашего контейнера приложения, как показано на следующем снимке экрана:

   >![Веб-страница ASP.NET Core, запускаемая из localhost в контейнере](media/SampleAppScreenshot.png)

## <a name="next-steps"></a>Дальнейшие действия

1. Следующий этап: публикация контейнера ASP.NET веб-приложения в частном реестре с помощью реестра контейнера Azure. Это позволит вам развернуть ее в Организации.

   > [!div class="nextstepaction"]
   > [Создание закрытого контейнера в реестре](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-powershell)

   Когда вы получаете доступ к разделу, в который вы [перемещаете изображение контейнера](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-powershell#push-image-to-registry), укажите имя ASP.NET приложения, которое вы только что упаковано`my-asp-app`() вместе с реестром контейнера (например: `contoso-container-registry`):

   ```PowerShell
   docker tag my-asp-app contoso-container-registry.azurecr.io/my-asp-app:v1
   ```

   Дополнительные примеры приложений и связанные с ними доккерфилес можно найти в разделе [Дополнительные примеры контейнеров](../samples.md).

2. После публикации приложения в реестре контейнера следующий шаг — это развертывание приложения в кластер Кубернетес, который вы создаете с помощью службы Кубернетес Azure.

   > [!div class="nextstepaction"]
   > [Создание кластера Кубернетес](https://docs.microsoft.com/azure/aks/windows-container-cli)
