# Развертывание узла контейнера Windows на новой виртуальной машине Hyper-V

В этом документе приведены пошаговые инструкции по развертыванию новой виртуальной машины Hyper-V, которая затем настраивается как узел контейнера Windows, с помощью сценария PowerShell.

Пошаговые инструкции по развертыванию узла контейнера Windows в существующей виртуальной или физической системе см. в разделе [Развертывание узла контейнера Windows на месте](./inplace_setup.md).

**ПРОЧТИТЕ ПЕРЕД УСТАНОВКОЙ ОБРАЗА ОС КОНТЕЙНЕРА.** Использование образа операционной системы контейнера Microsoft Windows ("дополнительное программное обеспечение") регулируется условиями лицензионного соглашения на использование предварительного выпуска Microsoft Windows Server ("Условия лицензионного соглашения"). Скачивая и используя дополнительное программное обеспечение, вы принимаете условия лицензионного соглашения. Иначе не используйте его. Предварительный выпуск Windows Server и дополнительное программное обеспечение лицензированы корпорацией Майкрософт.

Для выполнения упражнений этого руководства по быстрому запуску с **Windows Server** и **контейнерами Hyper-V** необходимо следующее.

* Система с Windows 10 (сборка 10586 или более поздняя) или Windows Server Technical Preview 4 или более поздней версии.
* Активированная роль Hyper-V ([см. инструкции](https://msdn.microsoft.com/virtualization/hyperv_on_windows/quick_start/walkthrough_install#UsingPowerShell))).
* 20 ГБ доступного пространства для образа узла контейнера, базового образа операционной системы и сценариев настройки.
* Права администратора на узле Hyper-V.

> Для виртуализированного узла с контейнерами Hyper-V необходимо использовать вложенную виртуализацию. Для этого операционная система физического и виртуального узлов должна ее поддерживать. Дополнительные сведения см. в разделе "Что нового в Hyper-V в [Windows Server 2016 Technical Preview](https://technet.microsoft.com/library/dn765471.aspx#BKMK_nested)".

## Настройка нового узла контейнера на новой виртуальной машине

Контейнеры Windows состоят из нескольких компонентов: узла контейнера Windows и базовых образов операционной системы контейнера. Мы создали сценарий для скачивания и настройки этих элементов. Выполните указанные ниже действия, чтобы развернуть новую виртуальную машину Hyper-V и настроить эту систему как узел контейнера Windows.

Запустите сеанс PowerShell от имени администратора. Для этого щелкните правой кнопкой мыши значок PowerShell и выберите команду "Запуск от имени администратора" или выполните следующую команду из сеанса PowerShell.

``` powershell
PS C:\> start-process powershell -Verb runAs
```

Перед тем как скачать и запустить сценарий, убедитесь, что создан внешний виртуальный коммутатор Hyper-V. Без него этот сценарий завершится ошибкой.

Выполните указанную ниже команду, чтобы вывести список внешних виртуальных коммутаторов. Если он пуст, создайте внешний виртуальный коммутатор, а затем перейдите к следующему шагу руководства.

```powershell
PS C:\> Get-VMSwitch | where {$_.SwitchType –eq “External”}
```

Скачайте сценарий настройки с помощью указанной ниже команды Этот сценарий также можно загрузить вручную по ссылке [Сценарий настройки](https://aka.ms/tp4/New-ContainerHost).

``` PowerShell
PS C:\> wget -uri https://aka.ms/tp4/New-ContainerHost -OutFile c:\New-ContainerHost.ps1
```

Выполните указанную ниже команду, чтобы создать и настроить узел контейнера, где `&lt;containerhost&gt;` — имя виртуальной машины.

``` powershell
PS C:\> c:\New-ContainerHost.ps1 –VmName <containerhost> -WindowsImage ServerDatacenterCore -Hyperv
```

После запуска сценария вам будет предложено ввести пароль от учетной записи администратора.

Далее вам будет предложено прочитать и принять условия лицензионного соглашения.

```
Before installing and using the Windows Server Technical Preview 4 with Containers virtual machine you must:
    1. Review the license terms by navigating to this link: http://aka.ms/tp4/containerseula
    2. Print and retain a copy of the license terms for your records.
By downloading and using the Windows Server Technical Preview 4 with Containers virtual machine you agree to such
license terms. Please confirm you have accepted and agree to the license terms.
[N] No  [Y] Yes  [?] Help (default is "N"):
```

Затем сценарий начнет скачивать и настраивать компоненты контейнера Windows. Это может занять некоторое время из-за большого размера компонентов. Когда сценарий закончит работу, виртуальная машина будет настроена, и вы сможете создавать контейнеры и образы контейнеров Windows, а также управлять ими с помощью PowerShell и Docker.

Используя пароль, указанный во время настройки, войдите в систему виртуальной машины и убедитесь, что она имеет допустимый IP-адрес. После этого вы можете приступать к работе с контейнерами Windows.

## Дальнейшие действия: начало работы с контейнерами

Включив функцию контейнеров Windows в системе Windows Server 2016, ознакомьтесь со следующими руководствами по началу работы с контейнерами Windows Server и Hyper-V.

[Быстрый запуск: контейнеры Windows и PowerShell](./manage_powershell.md)  
[Быстрый запуск: контейнеры Windows и Docker](./manage_docker.md)




<!--HONumber=Jan16_HO2-->
