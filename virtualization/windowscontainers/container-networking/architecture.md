---
title: Сетевые подключения контейнеров Windows
description: Постепенное введение в архитектуру сетей контейнеров Windows.
keywords: docker, контейнеры
author: jmesser81
ms.date: 03/27/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 538871ba-d02e-47d3-a3bf-25cda4a40965
ms.openlocfilehash: e9d4a9ac88c6853ce019a2469ee80688490b8fdf
ms.sourcegitcommit: 1ca9d7562a877c47f227f1a8e6583cb024909749
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74910704"
---
# <a name="windows-container-networking"></a>Сетевые подключения контейнеров Windows

>[!IMPORTANT]
>Сведения о сетевых командах DOCKER, параметрах и синтаксисе см. в разделе [Сетевые подключения контейнеров DOCKER](https://docs.docker.com/engine/userguide/networking/) . * * * за исключением случаев, описанных в разделе [неподдерживаемые функции и сетевые параметры](#unsupported-features-and-network-options), все сетевые команды DOCKER поддерживаются в Windows с тем же синтаксисом, что и в Linux. Однако сетевые стеки Windows и Linux отличаются друг от друга, и поэтому вы обнаружите, что некоторые сетевые команды Linux (например, ifconfig) не поддерживаются в Windows.

## <a name="basic-networking-architecture"></a>Базовая сетевая архитектура

В этом разделе приведено описание того, каким образом Docker создает и администрирует сети узлов в Windows. В отношении сетевых подключений контейнеры Windows функционируют аналогично виртуальным машинам. У каждого контейнера есть виртуальный сетевой адаптер (vNIC), который подключен к виртуальному коммутатору Hyper-V (vSwitch). Операционная система Windows поддерживает пять различных [сетевых драйверов (или по-другому "режимов")](./network-drivers-topologies.md), которые можно создать через Docker: *nat*, *overlay*, *transparent*, *l2bridge* и *l2tunnel*. В зависимости от особенностей физической сетевой инфраструктуры и от того, должна ли сеть быть одно- или многоузловой, необходимо выбрать сетевой драйвер, который наилучшим образом соответствует вашим потребностям.

![текст](media/windowsnetworkstack-simple.png)

При первом запуске подсистемы Docker происходит создание сети NAT по умолчанию ("nat"), которая использует внутренний виртуальный коммутатор и компонент Windows под названием `WinNAT`. При наличии на узле других внешних виртуальных коммутаторов, созданных с помощью оболочки командной строки PowerShell или диспетчера Hyper-V, они также будут доступны подсистеме Docker посредством сетевого драйвера *transparent* и будут отображаться при запуске команды ``docker network ls``.  

![текст](media/docker-network-ls.png)

- **Внутренний** vSwitch — это не подключенное напрямую к сетевому адаптеру на узле контейнера.
- **Внешняя** vSwitch — это тот, который напрямую подключен к сетевому адаптеру на узле контейнера.

![текст](media/get-vmswitch.png)

Сеть "nat" — это сеть по умолчанию для контейнеров под управлением Windows. Все контейнеры, которые работают под управлением Windows без каких-либо флагов или аргументов, использующихся для реализации конкретной сетевой конфигурации, будут подключены к сети "nat" по умолчанию и им будет автоматически присвоен IP-адрес из диапазона IP-адресов внутреннего префикса сети "nat". Для "nat" по умолчанию используется следующий внутренний префикс IP-адреса: 172.16.0.0/16. 

## <a name="container-network-management-with-host-network-service"></a>Управление сетью контейнера с помощью сетевой службы узлов

Сетевая служба узлов (HNS) и вычислительная служба узлов (HCS) совместно используются для создания контейнеров и подключения конечных точек к сети.

### <a name="network-creation"></a>Создание сети

- Служба HNS создает виртуальный коммутатор Hyper-V для каждой сети
- Служба HNS создает преобразование сетевых адресов (NAT) и пулы IP-адресов по мере необходимости

### <a name="endpoint-creation"></a>Создание конечных точек

- Служба HNS создает пространство имен сети для каждой конечной точки контейнера
- Служба HNS/HCS размещает сетевой адаптер виртуальной машины в пространстве имен сети
- Служба HNS создает порты виртуального коммутатора
- Служба HNS назначает конечной точке IP-адрес, сведения DNS, маршруты и т. д. (в зависимости от сетевого режима)

### <a name="policy-creation"></a>Создание политики

- Сеть NAT по умолчанию: служба HNS создает правила перенаправления портов WinNAT/сопоставления с соответствующими разрешающими правилами брандмауэра Windows.
- Остальные сети: служба HNS использует виртуальную платформу фильтрации для создания политики
    - Сюда входит следующее: балансировка нагрузки, списки управления доступом, инкапсуляция и т. д.
    - Найдите наши API-интерфейсы и схемы для HNS, опубликованные [здесь](https://docs.microsoft.com/en-us/windows-server/networking/technologies/hcn/hcn-top)

![текст](media/HNS-Management-Stack.png)

## <a name="unsupported-features-and-network-options"></a>Неподдерживаемые функции и сетевые параметры

В настоящее время в Windows **не** поддерживаются следующие сетевые параметры:

- Контейнеры Windows, подключенные к сетям l2bridge, NAT и оверлея, не поддерживают обмен данными через стек IPv6.
- Взаимодействие зашифрованного контейнера через IPsec.
- Поддержка прокси-сервера HTTP для контейнеров.
- Сеть в [режиме узла](https://docs.docker.com/ee/ucp/interlock/config/host-mode-networking/) 
- Сетевые подключения в виртуализованной инфраструктуре Azure с помощью драйвера прозрачной сети.

| Команда        | Неподдерживаемый параметр   |
|---------------|:--------------------:|
| ``docker run``|   ``--ip6``, ``--dns-option`` |
| ``docker network create``| ``--aux-address``, ``--internal``, ``--ip-range``, ``--ipam-driver``, ``--ipam-opt``, ``--ipv6``, ``--opt encrypted`` |
