---
title: Сетевые контейнеры Windows
description: Сетевые драйверы и топологии для контейнеров Windows.
keywords: docker, контейнеры
author: jmesser81
ms.date: 03/27/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 538871ba-d02e-47d3-a3bf-25cda4a40965
ms.openlocfilehash: 46eefb03f8f5a53333f5e7eca7074ab34e72a767
ms.sourcegitcommit: bb4ec1f05921f982c00bdb3ace6d9bc1d5355296
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2019
ms.locfileid: "10297255"
---
# <a name="windows-container-network-drivers"></a>Сетевые драйверы контейнера Windows  

Помимо использования сети "nat" по умолчанию, созданной подсистемой Docker в Windows, пользователи могут определять собственные сети контейнеров. Пользовательские сети можно создавать с помощью команды Dock CLI [`docker network create -d <NETWORK DRIVER TYPE> <NAME>`](https://docs.docker.com/engine/reference/commandline/network_create/) . В Windows доступны следующие типы сетевых драйверов.

- **nat**— контейнеры, подключенные к сети, которая была создана с помощью драйвера "nat", будут подключены к *внутреннему* коммутатору Hyper-V и получать IP-адрес из указанного пользователем префикса IP-адреса (``--subnet``). Перенаправление и сопоставление портов из узла контейнера в конечные точки контейнера поддерживается.
  
  >[!NOTE]
  > Сети NAT, созданные в Windows Server 2019 (или более поздней версии), больше не сохраняются после перезагрузки.

  > Если на вашем компьютере установлено обновление для Windows 10 Creators (или более поздней версии), поддерживаются несколько сетей NAT.
  
- **transparent**— контейнеры, подключенные к сети, которая была создана с помощью драйвера "transparent", будут подключены к физической сети напрямую через *внешний* коммутатор Hyper-V. IP-адреса из физической сети могут назначаться статически (необходим заданный пользователем параметр ``--subnet``) или динамически с помощью внешнего DHCP-сервера.
  
  >[!NOTE]
  >Из-за указанных ниже требований подключение узлов-контейнеров по прозрачной сети не поддерживается на виртуальных машинах Azure.
  
  > Требуется: Если этот режим используется в сценарии виртуализации (узел контейнера — это виртуальная машина), _требуется подмена Mac-адреса_.

- **overlay**— когда подсистема Docker запущена в [режиме мелких объектов](../manage-containers/swarm-mode.md), контейнеры, подключенные к сети наложения, могут связываться с другими контейнерами, подключенными к той же сети между несколькими узлами контейнера. Каждая сеть наложения, созданная в кластере мелких объектов, создается с собственной IP-подсетью, заданной частным IP-префиксом. Драйвер сети наложения использует инкапсуляцию VXLAN. **Может использоваться с Кубернетес при использовании подходящих управляющих плоскостей сети (например, Фланнел).**
  > Требуется: Убедитесь, что ваша среда удовлетворяет этим требованиям [для создания](https://docs.docker.com/network/overlay/#operations-for-all-overlay-networks) перекрытий сетей.

  > Требуется: в Windows Server 2019 для этого требуется [KB4489899](https://support.microsoft.com/help/4489899).

  > Требуется: в Windows Server 2016 для этого требуется [KB4015217](https://support.microsoft.com/help/4015217/windows-10-update-kb4015217).

  >[!NOTE]
  >В Windows Server 2019 для сетей с наложением, созданных службой Dock Сварм, используются правила NAT для исходящей связи. Это означает, что данный контейнер получает 1 IP-адрес. Кроме того, это означает, что средства, основанные на ПРОТОКОЛе ICMP, такие как `ping` или `Test-NetConnection` , должны быть настроены с использованием параметров TCP/UDP в отладочных ситуациях.

- **l2bridge** - `transparent` XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX ** XXXX XXXX XXXX XXXX XXXX XXXX. Разница в l2bridge заключается в том, что конечные точки контейнера будут иметь тот же MAC-адрес, что и узел, из-за преобразования адресов уровня 2 (в MAC-версии) для входных и выходных. В сценариях кластеризации это помогает сократить количество переключений на коммутаторы, которые позволят изучать MAC-адреса в некоторых коротких контейнерах. L2bridge сети можно настроить двумя различными способами:
  1. L2bridge сеть настроена с использованием той же IP-подсети, что и узел контейнера
  2. Конфигурация сети L2bridge с новой настраиваемой IP-подсетью
  
  Пользователи Configuration 2 должны добавить конечную точку в сегменте сети узла, который выступает в качестве шлюза, и настроить возможности маршрутизации для назначенного префикса. 
  > Требуется: требуется Windows Server 2016, Windows 10 Creators Update или более поздней версии.

  > Требуется: [аутбаунднат политика](./advanced.md#specify-outboundnat-policy-for-a-network) для внешних подключений.

- **l2tunnel** — похоже на l2bridge, но _этот драйвер следует использовать только в облачном стеке (Microsoft) (Azure)_. Пакеты, поступающие из контейнера, отправляются на узел виртуализации, на котором применяется политика SDN.


## <a name="network-topologies-and-ipam"></a>Сетевые топологии и IPAM

В следующей таблице показано, как сетевое подключение предоставляется для внутренних (контейнер-контейнер) и внешних подключений каждого сетевого драйвера.

### <a name="networking-modesdocker-drivers"></a>Сетевые режимы и драйверы стыковочного устройства

  | Сетевой драйвер Windows для Docker | Типичные способы использования | Контейнер для контейнера (один узел) | Контейнерный для внешних (один узел и несколько узлов) | Контейнер для контейнера (с несколькими узлами) |
  |-------------------------------|:------------:|:------------------------------------:|:------------------------------------------------:|:-----------------------------------:|
  | **NAT (по умолчанию)** | Удобно для разработчиков | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li> Перекрестная подсеть: не поддерживается (только один внутренний префикс NAT)</li></ul> | Маршрутизация через виртуальный сетевой адаптер управления (привязка к WinNAT) | Не поддерживается напрямую: требуется предоставление доступа к портам через узел |
  | **Прозрачный режим** | Удобно для разработчиков и небольших развертываний | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li>Подключение между подсетями: маршрутизация через узел контейнеров</li></ul> | Маршрутизация через узел контейнеров с прямым доступом к (физическому) сетевому адаптеру | Маршрутизация через узел контейнеров с прямым доступом к (физическому) сетевому адаптеру |
  | **Наложение** | Подходит для нескольких узлов; требуется для Dock Сварм, доступного в Кубернетес | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li>Подключение между подсетями: сетевой трафик инкапсулируется и маршрутизируется через виртуальный сетевой адаптер управления</li></ul> | Не поддерживается напрямую: требуется Вторая конечная точка контейнера, подключенная к сети NAT в правиле NAT Windows Server 2016 или VFP в Windows Server 2019.  | Одна подсеть/подключение между подсетями: сетевой трафик инкапсулируется с помощью VXLAN и маршрутизируется через виртуальный сетевой адаптер управления |
  | **L2Bridge** | Используется для Kubernetes и Microsoft SDN | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li> Подключение между подсетями: MAC-адрес контейнера повторно записывается при входе и выходе и маршрутизируется</li></ul> | MAC-адрес контейнера повторно записывается при входе и выходе | <ul><li>Одна подсеть: подключение с мостом</li><li>Перекрестная подсеть: перенаправление через вник в WSv1809 и более поздних версиях</li></ul> |
  | **L2Tunnel**| Только в Azure | Одна подсеть/подключение между подсетями: разворот пакетов на виртуальный коммутатор Hyper-V физического узла, к которому применяется политика | Трафик должен проходить через виртуальный сетевой шлюз Azure | Одна подсеть/подключение между подсетями: разворот пакетов на виртуальный коммутатор Hyper-V физического узла, к которому применяется политика |

### <a name="ipam"></a>IPAM

IP-адреса распределяются и назначаются каждому сетевому драйверу по-разному. Windows использует сетевую службу узлов (HNS) для передачи IPAM драйверу "nat" и работает в режиме мелких объектов Docker (внутренняя служба KVS) для передачи IPAM драйверу "overlay". Все остальные сетевые драйверы используют внешнюю платформу IPAM.

| Сетевой режим/драйвер | IPAM |
| -------------------------|:----:|
| NAT | Динамическое выделение и назначение IP-адресов для сетевой службы узла (HNS) из префикса внутренней подсети NAT |
| Прозрачный режим | Статическое или динамическое (с помощью внешнего DHCP-сервера) выделение и назначение IP-адресов из числа адресов в префиксе сети узла контейнеров |
| Наложение | Динамическое выделение IP-адресов из префиксов под управлением подсистемы Docker в режиме мелких объектов и их назначение через службу HNS |
| L2Bridge | Статический IP-адрес и назначение IP-адресов в префиксе сети узла контейнера (может быть назначено через службе HNS) |
| L2Tunnel | Только в Azure: динамическое выделение IP-адресов и их назначение через подключаемый модуль |

### <a name="service-discovery"></a>Обнаружение служб

Обнаружение служб поддерживают только определенные сетевые драйверы Windows.

|  | Локальное обнаружение служб  | Глобальное обнаружение служб |
| :---: | :---------------     |  :---                |
| nat | ДА | ДА, с помощью Docker EE |  
| overlay | ДА | Да, если вы дока в Docks EE или Кубе-DNS |
| прозрачный режим | NO | НЕТ |
| l2bridge | НЕТ | Да с помощью Кубе-DNS |
