---
title: Сетевые подключения контейнеров Windows
description: Сетевые драйверы и топологии для контейнеров Windows.
keywords: docker, контейнеры
author: jmesser81
ms.date: 03/27/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 538871ba-d02e-47d3-a3bf-25cda4a40965
ms.openlocfilehash: e2b3c05a35896d51b1fbd1bf3f276791e4e08493
ms.sourcegitcommit: a5ff22c205149dac4fc05325ef3232089826f1ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2019
ms.locfileid: "9380018"
---
# <a name="windows-container-network-drivers"></a>Сетевые драйверы контейнеров Windows  

Помимо использования сети "nat" по умолчанию, созданной подсистемой Docker в Windows, пользователи могут определять собственные сети контейнеров. Пользовательские сети можно создавать в интерфейсе командной строки Docker (команда [`docker network create -d <NETWORK DRIVER TYPE> <NAME>`](https://docs.docker.com/engine/reference/commandline/network_create/)). В Windows доступны следующие типы сетевых драйверов.

- **nat**— контейнеры, подключенные к сети, которая была создана с помощью драйвера "nat", будут подключены к *внутреннему* коммутатору Hyper-V и получать IP-адрес из указанного пользователем префикса IP-адреса (``--subnet``). Перенаправление и сопоставление портов из узла контейнера в конечные точки контейнера поддерживается.
  
  >[!NOTE]
  >Несколько сетей NAT поддерживаются, если у вас установлен Windows 10 Creators Update.

- **transparent**— контейнеры, подключенные к сети, которая была создана с помощью драйвера "transparent", будут подключены к физической сети напрямую через *внешний* коммутатор Hyper-V. IP-адреса из физической сети могут назначаться статически (необходим заданный пользователем параметр ``--subnet``) или динамически с помощью внешнего DHCP-сервера.
  
  >[!NOTE]
  >Из-за следующих требований подключение узлов контейнера прозрачной сети не поддерживается на виртуальных машинах Azure.
  
  > Требуется: При использовании этого режима в сценарии виртуализации (узла контейнеров выполняет виртуальная машина) _спуфинг MAC-адресов является обязательным_.

- **overlay**— когда подсистема Docker запущена в [режиме мелких объектов](../manage-containers/swarm-mode.md), контейнеры, подключенные к сети наложения, могут связываться с другими контейнерами, подключенными к той же сети между несколькими узлами контейнера. Каждая сеть наложения, созданная в кластере мелких объектов, создается с собственной IP-подсетью, заданной частным IP-префиксом. Драйвер сети наложения использует инкапсуляцию VXLAN. **Можно использовать с Kubernetes при использовании с подходящими плоскостями контроля сети (Flannel или OVN).**
  > Требуется: Убедитесь, что ваша среда соответствует этим необходимые [Необходимые условия](https://docs.docker.com/network/overlay/#operations-for-all-overlay-networks) для создания сетей наложения.

  > Требуется: Требуется Windows Server 2016 с [KB4015217](https://support.microsoft.com/en-us/help/4015217/windows-10-update-kb4015217), Windows 10 Creators Update или более поздней версии.

  >[!NOTE]
  >В Windows Server 2019 под управлением Docker EE 18.03 и более поздних версий, сети наложения, созданным режима мелких объектов Docker используйте VFP NAT правила для исходящего подключения. Это означает, что thata контейнера получает 1 IP-адрес. Это также означает, что на основе ICMP такие средства, как `ping` или `Test-NetConnection` должна быть настроена с помощью их TCP/UDP параметры отладки ситуациях.

- **l2bridge**— контейнеры, которые подключены к сети, созданной с использованием драйвера l2bridge, будут расположены в той же IP-подсети, что и узел контейнеров, и подключены к физической сети через *внешний* коммутатор Hyper-V. IP-адреса должны назначаться статически из того же префикса, что и узел контейнера. У всех конечных точек контейнера на узле будет одинаковый с узлом MAC-адрес из-за преобразования адресов второго уровня (перезапись MAC-адресов) во входящем и исходящем трафике.
  > Требуется: При использовании этого режима в сценарии виртуализации (узла контейнеров выполняет виртуальная машина) _спуфинг MAC-адресов является обязательным_.
  
  > Требуется: Требуется Windows Server 2016, Windows 10 Creators Update или более поздней версии.

- **l2tunnel** — аналогично l2bridge, однако _Этот драйвер должен использоваться только в Microsoft Cloud Stack, например Azure_. Пакеты, поступающие из контейнера, отправляются на узел виртуализации, на котором применяется политика SDN.

## <a name="network-topologies-and-ipam"></a>Сетевые топологии и IPAM

В следующей таблице показано, как сетевое подключение предоставляется для внутренних (контейнер-контейнер) и внешних подключений каждого сетевого драйвера.

### <a name="networking-modesdocker-drivers"></a>Сетевые драйверы режимы/Docker

  | Сетевой драйвер Windows для Docker | Типичные контейнеры | Контейнер контейнер (один узел) | Контейнер--внешняя сеть (один узел + несколько узлов) | Контейнер контейнер (несколько узлов) |
  |-------------------------------|:------------:|:------------------------------------:|:------------------------------------------------:|:-----------------------------------:|
  | **NAT (по умолчанию)** | Удобно для разработчиков | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li> Подключение между подсетями: не поддерживается (только один внутренний префикс NAT)</li></ul> | Маршрутизация через виртуальный сетевой адаптер управления (привязка к WinNAT) | Не поддерживается напрямую: требуется предоставление доступа к портам через узел |
  | **Прозрачный режим** | Удобно для разработчиков и небольших развертываний | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li>Подключение между подсетями: маршрутизация через узел контейнеров</li></ul> | Маршрутизация через узел контейнеров с прямым доступом к (физическому) сетевому адаптеру | Маршрутизация через узел контейнеров с прямым доступом к (физическому) сетевому адаптеру |
  | **Наложение** | Удобно для нескольких узлов; требуется для Docker Swarm, доступные в Kubernetes | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li>Подключение между подсетями: сетевой трафик инкапсулируется и маршрутизируется через виртуальный сетевой адаптер управления</li></ul> | Не поддерживается напрямую: требуется вторая конечная точка контейнера, подключенная к сети NAT | Одна подсеть/подключение между подсетями: сетевой трафик инкапсулируется с помощью VXLAN и маршрутизируется через виртуальный сетевой адаптер управления |
  | **L2Bridge** | Используется для Kubernetes и Microsoft SDN | <ul><li>Одна подсеть: подключение с мостом через виртуальный коммутатор Hyper-V</li><li> Подключение между подсетями: MAC-адрес контейнера повторно записывается при входе и выходе и маршрутизируется</li></ul> | MAC-адрес контейнера повторно записывается при входе и выходе | <ul><li>Одна подсеть: подключение с мостом</li><li>Подключение между подсетями: Маршрутизация через виртуальный сетевой адаптер управления на WSv1709 и выше.</li></ul> |
  | **L2Tunnel**| Только в Azure | Одна подсеть/подключение между подсетями: разворот пакетов на виртуальный коммутатор Hyper-V физического узла, к которому применяется политика | Трафик должен проходить через виртуальный сетевой шлюз Azure | Одна подсеть/подключение между подсетями: разворот пакетов на виртуальный коммутатор Hyper-V физического узла, к которому применяется политика |

### <a name="ipam"></a>IPAM

IP-адреса распределяются и назначаются каждому сетевому драйверу по-разному. Windows использует сетевую службу узлов (HNS) для передачи IPAM драйверу "nat" и работает в режиме мелких объектов Docker (внутренняя служба KVS) для передачи IPAM драйверу "overlay". Все остальные сетевые драйверы используют внешнюю платформу IPAM.

| Сетевой режим/драйвер | IPAM |
| -------------------------|:----:|
| NAT | Динамическое выделение и назначение сеть службой узлов (HNS) из внутреннего префикса сети NAT |
| Прозрачный режим | Статическое или динамическое (с помощью внешнего DHCP-сервера) выделение и назначение IP-адресов из числа адресов в префиксе сети узла контейнеров |
| Наложение | Динамическое выделение IP-адресов из префиксов под управлением подсистемы Docker в режиме мелких объектов и их назначение через службу HNS |
| L2Bridge | Статическое выделение и назначение IP-адресов в префиксе сети узла контейнеров (также возможно назначение через службу HNS) |
| L2Tunnel | Только в Azure: динамическое выделение IP-адресов и их назначение через подключаемый модуль |

### <a name="service-discovery"></a>Обнаружение служб

Обнаружение служб поддерживают только определенные сетевые драйверы Windows.

|  | Локальное обнаружение служб  | Глобальное обнаружение служб |
| :---: | :---------------     |  :---                |
| nat | ДА | ДА, с помощью Docker EE |  
| overlay | ДА | Да, с помощью Docker EE или помощью kube-dns |
| прозрачный режим | NO | НЕТ |
| l2bridge | НЕТ | Да, с помощью kube-dns |
